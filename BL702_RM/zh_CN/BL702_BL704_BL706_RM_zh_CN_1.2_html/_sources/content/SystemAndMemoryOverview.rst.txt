==================
系统和存储器概述
==================

简介
=========
芯片内处理器采用 32-bit 带浮点的 RISC-V 。
搭配高速缓存 (详见 L1C 章节)，达到优质的运算效率。
处理器外部为多层 32-bit AHB 架构，具有低功耗、低延迟、高弹性的特性。
内存部分包含高速紧耦合内存以及缓存和系统共享内存。
片外存储器支持 Flash 扩充。

主要特征
=================
• RISC-V 32-bit 带浮点
• 多层 32-bit AHB 总线架构
• 132KB RAM
• 192KB ROM
• 片外存储器 Flash

功能描述
================

BL702/704/706总线连接与地址访问总结如下：
总线主机包括CPU，以太网，DMA，加密引擎，调试接口。
总线从机包括内存，外设，Zigbee/BLE。
除了以太网和加密引擎只能访问内存外，其余总线主机皆可访问所有总线从机。

.. table:: 总线连接
    :widths: 16, 16, 16, 16, 16, 20
    :width: 100%
    :align: center

    +-----------+------------+-------+--------+----------+---------+
    |  从/主    |  CPU       | 以太网| DMA    |加密引擎  | 调试接口|
    +===========+============+=======+========+==========+=========+
    | 内存      | V          | V     | V      |      V   | V       |
    +-----------+------------+-------+--------+----------+---------+
    | 外设      | V          | \-    | V      |      \-  | V       |
    +-----------+------------+-------+--------+----------+---------+
    |Zigbee/BLE | V          | \-    | V      |      \-  | V       |
    +-----------+------------+-------+--------+----------+---------+

地址访问主要以[27:24]来区分"存储"或"外设"，可忽略[31:28]。
内存空间是连续的X2010000~X202FFFF (128KB SRAM)，只读内存X1000000，深度睡眠内存X0010000。
片外空间是X3000000 (最大支持 8MB Flash)。
外设空间是X0000000~X000F000。

.. table:: 地址映像
    :widths: 20, 20, 20, 40
    :width: 100%
    :align: center

    +--------+------------+-------+-------------------------------+
    |  目标  |  开始地址  | 大小  |         描述                  |
    +========+============+=======+===============================+
    | RETRAM | 0x40010000 | 4KB   | 深度睡眠内存（保留RAM）       |
    +--------+------------+-------+-------------------------------+
    | HBN    | 0x4000F000 | 4KB   | 深度睡眠控制（休眠）          |
    +--------+------------+-------+-------------------------------+
    | PDS    | 0x4000E000 | 4KB   | 睡眠控制（掉电睡眠）          |
    +--------+------------+-------+-------------------------------+
    | USB    | 0x4000D800 | 1KB   | USB控制                       |
    +--------+------------+-------+-------------------------------+
    | EMAC   | 0x4000D000 | 2KB   | EMAC控制                      |
    +--------+------------+-------+-------------------------------+
    | DMA    | 0x4000C000 | 4KB   | DMA控制                       |
    +--------+------------+-------+-------------------------------+
    | QSPI   | 0x4000B000 | 4KB   | 闪存/pSRAM QSPI控制           |
    +--------+------------+-------+-------------------------------+
    | I2S    | 0x4000AA00 | 256B  | I2S控制                       |
    +--------+------------+-------+-------------------------------+
    | KYS    | 0x4000A900 | 256B  | Key-Scan控制                  |
    +--------+------------+-------+-------------------------------+
    | QDEC2  | 0x4000A880 | 64B   | 求积译码器控制                |
    +--------+------------+-------+-------------------------------+
    | QDEC1  | 0x4000A840 | 64B   | 求积译码器控制                |
    +--------+------------+-------+-------------------------------+
    | QDEC0  | 0x4000A800 | 64B   | 求积译码器控制                |
    +--------+------------+-------+-------------------------------+
    | IRR    | 0x4000A600 | 256B  | 红外遥控器                    |
    +--------+------------+-------+-------------------------------+
    | TIMER  | 0x4000A500 | 256B  | 计时器控制                    |
    +--------+------------+-------+-------------------------------+
    | PWM    | 0x4000A400 | 256B  | 脉冲宽度调制控制              |
    +--------+------------+-------+-------------------------------+
    | I2C    | 0x4000A300 | 256B  | I2C控制                       |
    +--------+------------+-------+-------------------------------+
    | SPI    | 0x4000A200 | 256B  | SPI主/从控制                  |
    +--------+------------+-------+-------------------------------+
    | UART1  | 0x4000A100 | 256B  | UART控制                      |
    +--------+------------+-------+-------------------------------+
    | UART0  | 0x4000A000 | 256B  | UART控制                      |
    +--------+------------+-------+-------------------------------+
    | L1C    | 0x40009000 | 4KB   | 缓存控制                      |
    +--------+------------+-------+-------------------------------+
    | eFuse  | 0x40007000 | 4KB   | eFuse存储器控制               |
    +--------+------------+-------+-------------------------------+
    | SEC    | 0x40004000 | 4KB   | 安全引擎                      |
    +--------+------------+-------+-------------------------------+
    | GPIP   | 0x40002000 | 4KB   | 通用DAC / ADC / ACOMP接口控制 |
    +--------+------------+-------+-------------------------------+
    | MIX    | 0x40001000 | 4KB   | 混合信号寄存器                |
    +--------+------------+-------+-------------------------------+
    | GLB    | 0x40000000 | 4KB   | 全局寄存器                    |
    +--------+------------+-------+-------------------------------+
    | pSRAM  | 0x24000000 | 8MB   | pSRAM存储器                   |
    +--------+------------+-------+-------------------------------+
    | XIP    | 0x23000000 | 8MB   | XIP闪存                       |
    +--------+------------+-------+-------------------------------+
    | OCRAM  | 0x22020000 | 64KB  | 片上存储器                    |
    +--------+------------+-------+-------------------------------+
    | DTCM   | 0x22014000 | 48KB  | 数据高速缓存                  |
    +--------+------------+-------+-------------------------------+
    | ITCM   | 0x22010000 | 16KB  | 指令高速缓存                  |
    +--------+------------+-------+-------------------------------+
    | ROM    | 0x21000000 | 192KB | 只读存储器                    |
    +--------+------------+-------+-------------------------------+

中断源共64个，列举如下，电平或边沿触发由CPU配置，可屏蔽使用。

.. table:: 中断源 
    :widths: 50, 50
    :width: 100%
    :align: center

    +-----------+----------------+
    |  编号     |  讯号源        |
    +===========+================+
    | 54~63     | wireless       |
    +-----------+----------------+
    | 53        | brown-out      |
    +-----------+----------------+
    | 51~52     | hbn_irq        |
    +-----------+----------------+
    | 50        | pds_int        |
    +-----------+----------------+
    | 47~49     | wireless       |  
    +-----------+----------------+
    | 44        | gpio_irq       |
    +-----------+----------------+
    | 40~42     | qdec_int       |
    +-----------+----------------+
    | 39        | kys_int        |
    +-----------+----------------+
    | 35~38     | timer_irq      |
    +-----------+----------------+
    | 34        | pwm_int        |
    +-----------+----------------+
    | 32        | i2c_int        |
    +-----------+----------------+
    | 30        | uart1_irq      |
    +-----------+----------------+
    | 29        | uart0_irq      |
    +-----------+----------------+
    | 27        | spi_int        |
    +-----------+----------------+
    | 26        | efuse_int      |
    +-----------+----------------+
    | 25        | adc_int        |
    +-----------+----------------+
    | 23        | flash_int      |
    +-----------+----------------+
    | 22        | emac_int       |
    +-----------+----------------+
    | 21        | usb_int        |
    +-----------+----------------+
    | 19~20     | ir_remote_int  |
    +-----------+----------------+
    | 18        | i2s_int        |
    +-----------+----------------+
    | 15        | dma_int        |
    +-----------+----------------+
    | 9~14      | sec_eng_int    |
    +-----------+----------------+
    | 8         | err_int        |
    +-----------+----------------+
    | 5~6       | rf_int         |
    +-----------+----------------+
    | 0~4       | err_int        |
    +-----------+----------------+