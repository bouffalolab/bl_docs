========
功能描述
========
BL602/BL604主要功能描述如下:

.. figure:: /content/Functional/picture/SystemArchitecture.png
   :align: center

   系统框图

CPU
====
BL602/BL604 32-bit RISC CPU包含用于32位单精度算术的FPU（浮点单元），
三级流水线（IF，EXE，WB），压缩的16位和32位指令集，包含4个硬件可编程断点
的标准JTAG调试器端口，包含64个中断和16个中断级别/优先级的中断控制器，
用于低延迟中断处理。 时钟频率高达192MHz，可以动态配置用来更改时钟频率，
进入省电模式以实现低功耗。

WiFi/BLE堆栈和应用程序均在单个32-bit RISC CPU上运行，
用来实现简单和超低功耗的应用程序。CPU性能约1.46 DMIPS / MHz；3.1 CoreMark / MHz。

缓存
=============
BL602/BL604的缓存提高了CPU访问外部存储器的效能。 
高速缓存可以部分或全部配置为TCM（紧密耦合内存）。

内存
=============
BL602/BL604存储器包括：片上零延迟SRAM存储器，只读存储器，一次写入存储器，
嵌入式闪存（可选）。

DMA控制器
==========
BL602/BL604 DMA（直接存储器访问）控制器具有四个专用通道，
用于管理外设和存储器之间的数据传输，以提高CPU /总线效率。 
DMA有三种主要的传输类型，内存到内存，内存到外设以及外设到内存三种模式。 
DMA还支持LLI（链接列表项）功能，该链表由一系列链接列表预定义了多个传输，
然后硬件会根据每个LLI的大小和地址自动完成所有传输。

DMA支持的外设包括UART，I2C，SPI，ADC和DAC。

总线结构
=========
BL602/BL604总线连接与地址访问总结如下：

.. table:: 总线连接

    +--------+------------+-------+--------+----------+---------+
    |  从/主 |  CPU       | SDIO  | DMA    |加密引擎  | 调试接口|
    +--------+------------+-------+--------+----------+---------+
    | 内存   | V          | V     | V      |      V   | V       |
    +--------+------------+-------+--------+----------+---------+
    | 外设   | V          | V     | V      |      -   | V       |
    +--------+------------+-------+--------+----------+---------+
    |WiFi/BLE| V          | V     | V      |      -   | V       |
    +--------+------------+-------+--------+----------+---------+


.. table:: 地址映像

    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    |  目标  |  开始地址             | 大小  |         描述                                                                                              |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | WRAM   | 0x42030000            | 112KB | 无线SRAM存储器                                                                                            |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | RETRAM | 0x40010000            | 4KB   | 深度睡眠内存（保留RAM）                                                                                   |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | HBN    | 0x4000F000            | 4KB   | 深度睡眠控制（休眠）                                                                                      |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | PDS    | 0x4000E000            | 4KB   | 睡眠控制（掉电睡眠）                                                                                      |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | SDU    | 0x4000D000            | 4KB   | SDIO控制                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | DMA    | 0x4000C000            | 4KB   | DMA控制                                                                                                   |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | QSPI   | 0x4000B000            | 4KB   | Flash闪存控制                                                                                             |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | IRR    | 0x4000A600            | 256B  | 红外遥控器                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TIMER  | 0x4000A500            | 256B  | 计时器控制                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | PWM    | 0x4000A400            | 256B  | 脉冲宽度调制控制                                                                                          |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | I2C    | 0x4000A300            | 256B  | I2C控制                                                                                                   |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | SPI    | 0x4000A200            | 256B  | SPI主/从控制                                                                                              |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | UART1  | 0x4000A100            | 256B  | UART控制                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | UART0  | 0x4000A000            | 256B  | UART控制                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | L1C    | 0x40009000            | 4KB   | 缓存控制                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | eFuse  | 0x40007000            | 4KB   | eFuse存储器控制                                                                                           |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TZ2    | 0x40006000            | 4KB   | 信任区隔离                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TZ1    | 0x40005000            | 4KB   | 信任区隔离                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | SEC    | 0x40004000            | 4KB   | 安全引擎                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | GPIP   | 0x40002000            | 4KB   | 通用DAC / ADC / ACOMP接口控制                                                                             |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | MIX    | 0x40001000            | 4KB   | 混合信号寄存器                                                                                            |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | GLB    | 0x40000000            | 4KB   | 全局寄存器                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | RAM    | 0x22020000/0x42020000 | 64KB  | 片上存储器,如果用作数据存储器，则使用0x42020000地址访问；如果用作程序存储器，则使用0x22020000地址访问     |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | XIP    | 0x23000000            | 16MB  | XIP闪存                                                                                                   |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TCM1   | 0x22014000/0x42014000 | 48KB  | 紧耦合内存，如果用作数据存储器，则使用0x42014000地址访问；如果用作程序存储器，则使用0x22014000地址访问    |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TCM0   | 0x22008000/0x42008000 | 48KB  | 紧耦合内存，如果用作数据存储器，则使用0x42008000地址访问；如果用作程序存储器，则使用0x22008000地址访问    |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | ROM    | 0x21000000            | 128KB | 只读存储器                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+


中断
=====
BL602/BL604支持内部RTC时钟唤醒、外部中断唤醒，以达到低功耗睡眠唤醒机制。

CPU中断控制器支持堆栈或嵌套、可选电平或脉冲、高或低电平有效。

启动选项
=========
BL602/BL604支持多种启动，可选择从UART、SDIO、Flash闪存启动。

电源管理单元
=============
电源管理单元（PMU）管理整个芯片的电源，可分为运行、空闲、睡眠和休眠电源模式。
软件配置成进入睡眠模式时，可以通过RTC定时器或EINT来唤醒，以达到低功耗电源管理。

掉电睡眠模式非常灵活，可以使应用配置为最低功耗。

时钟架构
=========
时钟控制单元为核心MCU和外围SOC设备生成时钟。 时钟源可以是XTAL，PLL或RC振荡器。 
通过适当的配置（例如sel，div，en等）来动态节省功耗。PMU以32kHz时钟运行，
使系统在睡眠模式下保持低功耗。

.. figure:: /content/Functional/picture/clocktree.png
   :align: center

   时钟框图


外设
======
外设包括SDIO，SPI，UART，I2C，IR remote，PWM，ADC，DAC，PIR。
可以通过灵活的配置将每个外设分配给不同的GPIO组。
每个GPIO都可用作通用输入和输出功能。
