==================
系统和存储器概述
==================

简介
=========
芯片内处理器采用 RISC-V 32-bit 带浮点。
搭配高速处理内存系统 (详见 L1C 章节)，达到优质的运算效率。
处理器外部为多层 32-bit AHB 架构，具有低功耗、低延迟、高弹性的特性。
内存的部分包含高速紧耦合内存以及缓存和系统共享内存。
片外存储器支持 Flash 扩充。

主要特征
=================
• RISC-V 32-bit 带浮点
• 多层 32-bit AHB 总线架构
• 96KB 高速内存
• 180KB 系统内存
• 128KB 只读内存
• 片外存储器 Flash

功能描述
================

BL602总线连接与地址访问总结如下。
总线主设备包括CPU,SDIO,DMA,加密引擎,调试接口。
总线从设备包括内存,外设,WiFi/BLE。
除了加密引擎只能访问内存外，其余总线主设备皆可访问所有总线从设备。

.. table:: 总线连接

    +--------+------------+-------+--------+----------+---------+
    |  从/主 |  CPU       | SDIO  | DMA    |加密引擎  | 调试接口|
    +--------+------------+-------+--------+----------+---------+
    | 内存   | V          | V     | V      |      V   | V       |
    +--------+------------+-------+--------+----------+---------+
    | 外设   | V          | V     | V      |      -   | V       |
    +--------+------------+-------+--------+----------+---------+
    |WiFi/BLE| V          | V     | V      |      -   | V       |
    +--------+------------+-------+--------+----------+---------+


地址访问主要以[27:24]来区分"存储"或"外设"，可忽略[31:28]。
内存空间是连续的X2008000~X204BFFF (272KB SRAM)，只读内存X1000000，深度睡眠内存X0010000。
片外空间是X3000000 (最大支持 16MB Flash)。
外设空间是X0000000~X000F000。

.. table:: 地址映像

    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    |  目标  |  开始地址             | 大小  |         描述                                                                                              |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | WRAM   | 0x42030000            | 112KB | 无线SRAM存储器                                                                                            |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | RETRAM | 0x40010000            | 4KB   | 深度睡眠内存（保留RAM）                                                                                   |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | HBN    | 0x4000F000            | 4KB   | 深度睡眠控制（休眠）                                                                                      |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | PDS    | 0x4000E000            | 4KB   | 睡眠控制（掉电睡眠）                                                                                      |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | SDU    | 0x4000D000            | 4KB   | SDIO控制                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | DMA    | 0x4000C000            | 4KB   | DMA控制                                                                                                   |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | QSPI   | 0x4000B000            | 4KB   | Flash闪存控制                                                                                             |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | IRR    | 0x4000A600            | 256B  | 红外遥控器                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TIMER  | 0x4000A500            | 256B  | 计时器控制                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | PWM    | 0x4000A400            | 256B  | 脉冲宽度调制控制                                                                                          |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | I2C    | 0x4000A300            | 256B  | I2C控制                                                                                                   |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | SPI    | 0x4000A200            | 256B  | SPI主/从控制                                                                                              |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | UART1  | 0x4000A100            | 256B  | UART控制                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | UART0  | 0x4000A000            | 256B  | UART控制                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | L1C    | 0x40009000            | 4KB   | 缓存控制                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | eFuse  | 0x40007000            | 4KB   | eFuse存储器控制                                                                                           |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TZ2    | 0x40006000            | 4KB   | 信任区隔离                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TZ1    | 0x40005000            | 4KB   | 信任区隔离                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | SEC    | 0x40004000            | 4KB   | 安全引擎                                                                                                  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | GPIP   | 0x40002000            | 4KB   | 通用DAC / ADC / ACOMP接口控制                                                                             |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | MIX    | 0x40001000            | 4KB   | 混合信号寄存器                                                                                            |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | GLB    | 0x40000000            | 4KB   | 全局寄存器                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | RAM    | 0x22020000/0x42020000 | 64KB  | 片上存储器,如果用作数据存储器，则使用0x42020000地址访问；如果用作程序存储器，则使用0x22020000地址访问     |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | XIP    | 0x23000000            | 16MB  | XIP闪存                                                                                                   |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TCM1   | 0x22014000/0x42014000 | 48KB  | 紧耦合内存，如果用作数据存储器，则使用0x42014000地址访问；如果用作程序存储器，则使用0x22014000地址访问    |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | TCM0   | 0x22008000/0x42008000 | 48KB  | 紧耦合内存，如果用作数据存储器，则使用0x42008000地址访问；如果用作程序存储器，则使用0x22008000地址访问    |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+
    | ROM    | 0x21000000            | 128KB | 只读存储器                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------+


中断源共64个，列举如下，电平或边沿触发由CPU配置，可屏蔽使用。

.. table:: 中断源

    +-----------+----------------+
    |  编号     |  讯号源        |
    +-----------+----------------+
    | 54~63     | wireless       |
    +-----------+----------------+
    | 53        | brown-out      |
    +-----------+----------------+
    | 51~52     | hbn_irq        |
    +-----------+----------------+
    | 50        | pds_int        |
    +-----------+----------------+
    | 44        | gpio_irq       |
    +-----------+----------------+
    | 35~38     | timer_irq      |
    +-----------+----------------+
    | 34        | pwm_int        |
    +-----------+----------------+
    | 32        | i2c_int        |
    +-----------+----------------+
    | 30        | uart1_irq      |
    +-----------+----------------+
    | 29        | uart0_irq      |
    +-----------+----------------+
    | 27        | spi_int        |
    +-----------+----------------+
    | 26        | efuse_int      |
    +-----------+----------------+
    | 25        | adc_int        |
    +-----------+----------------+
    | 23        | flash_int      |
    +-----------+----------------+
    | 19~20     | ir_remote_int  |
    +-----------+----------------+
    | 15        | dma_int        |
    +-----------+----------------+
    | 9~14      | sec_eng_int    |
    +-----------+----------------+
    | 7         | sdio_int       |
    +-----------+----------------+
    | 5~6       | rf_int         |
    +-----------+----------------+
    | 0~4       | err_int        |
    +-----------+----------------+