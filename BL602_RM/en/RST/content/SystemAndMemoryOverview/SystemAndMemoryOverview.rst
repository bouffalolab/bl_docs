==============================
System and memory overview
==============================

Introduction
==============
The on-chip processor uses RISC-V 32-bit with floating point.
With high-speed processing memory system (see the L1C chapter for details), to achieve high-quality computing efficiency.
External to the processor is a multilayer 32-bit AHB architecture with low power consumption, low latency, and high flexibility.
The memory section contains high-speed tightly coupled memory as well as cache and system shared memory.
Off-chip memory supports Flash expansion.

Main features
=================
• RISC-V 32-bit with floating point
• Multi-layer 32-bit AHB bus architecture
• 96KB high-speed memory
• 180KB system memory
• 128KB read-only memory
• Off-chip memory Flash

Function description
======================

The BL602 bus connection and address access are summarized as follows:
The bus master includes CPU, SDIO, DMA, encryption engine, and debug interface.
The bus includes memory, peripherals, WiFi / BLE.
Except the encryption engine can only access the memory, all other bus masters can access all bus slaves.

.. table:: Bus connection

    +-----------------+------------+-------+--------+-------------------+----------------+
    |  Slave / Master |  CPU       | SDIO  | DMA    |encryption engine  | Debug interface|
    +-----------------+------------+-------+--------+-------------------+----------------+
    | memory          | V          | V     | V      |      V            | V              |
    +-----------------+------------+-------+--------+-------------------+----------------+
    | Peripheral      | V          | V     | V      |      -            | V              |
    +-----------------+------------+-------+--------+-------------------+----------------+
    |WiFi/BLE         | V          | V     | V      |      -            | V              |
    +-----------------+------------+-------+--------+-------------------+----------------+


The address access mainly distinguishes "memory" or "peripheral" by [27:24], and the [31:28] bits can be ignored.
The memory space is consecutive addresses 0x2008000 ~ 0x204BFFF (272KB SRAM), the read-only memory address is 0x1000000, and the deep sleep memory address is 0x0010000.
The off-chip space address is 0x3000000 (maximum support 16MB Flash).
The peripheral space is 0x0000000 ~ 0x000F000.

.. table:: Memory Map

    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    |Module  |Base Address           | Size  |    Description                                                                                                                          |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | WRAM   | 0x42030000            | 112KB | Wireless SRAM memory                                                                                                                    |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | RETRAM | 0x40010000            | 4KB   | Deep sleep memory (Retention RAM)                                                                                                       |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | HBN    | 0x4000F000            | 4KB   | Deep sleep control (Hibernate)                                                                                                          |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | PDS    | 0x4000E000            | 4KB   | Sleep control (Power Down Sleep)                                                                                                        |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | SDU    | 0x4000D000            | 4KB   | SDIO control                                                                                                                            |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | DMA    | 0x4000C000            | 4KB   | DMA control                                                                                                                             |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | QSPI   | 0x4000B000            | 4KB   | Flash control                                                                                                                           |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | IRR    | 0x4000A600            | 256B  | IR Remote control                                                                                                                       |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | TIMER  | 0x4000A500            | 256B  | Timer control                                                                                                                           |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | PWM    | 0x4000A400            | 256B  | Pulse Width Modulation \*5 control                                                                                                      |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | I2C    | 0x4000A300            | 256B  | I2C control                                                                                                                             |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | SPI    | 0x4000A200            | 256B  | SPI master/slave control                                                                                                                |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | UART1  | 0x4000A100            | 256B  | UART control                                                                                                                            |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | UART0  | 0x4000A000            | 256B  | UART control                                                                                                                            |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | L1C    | 0x40009000            | 4KB   | Cache control                                                                                                                           |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | eFuse  | 0x40007000            | 4KB   | eFuse memory control                                                                                                                    |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | TZ2    | 0x40006000            | 4KB   | Trust isolation                                                                                                                         |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | TZ1    | 0x40005000            | 4KB   | Trust isolation                                                                                                                         |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | SEC    | 0x40004000            | 4KB   | Security engine                                                                                                                         |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | GPIP   | 0x40002000            | 4KB   | General purpose DAC/ADC/ACOMP interface control                                                                                         |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | MIX    | 0x40001000            | 4KB   | Mixed signal register                                                                                                                   |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | GLB    | 0x40000000            | 4KB   | Global control register                                                                                                                 |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | RAM    | 0x22020000/0x42020000 | 64KB  | On-chip memory.If used as data memory, use address 0x42020000 for access; if used as program memory, use address 0x22020000 for access  |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | XIP    | 0x23000000            | 16MB  | XIP Flash memory                                                                                                                        |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | TCM1   | 0x22014000/0x42014000 | 48KB  | Cache memory.If used as data memory, use address 0x42014000 for access; if used as program memory, use address 0x22014000 for access    |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | TCM0   | 0x22008000/0x42008000 | 48KB  | Cache memory.If used as data memory, use address 0x42008000 for access; if used as program memory, use address 0x22008000 for access    |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+
    | ROM    | 0x21000000            | 128KB | Read-only memory                                                                                                                        |
    +--------+-----------------------+-------+-----------------------------------------------------------------------------------------------------------------------------------------+

There are 64 interrupt sources. The level or edge trigger is configured by the CPU and can be masked. Details as follows:

.. table:: Interrupt source

    +-----------+----------------+
    |  Num      | Signal source  |
    +-----------+----------------+
    | 54~63     | wireless       |
    +-----------+----------------+
    | 53        | brown-out      |
    +-----------+----------------+
    | 51~52     | hbn_irq        |
    +-----------+----------------+
    | 50        | pds_int        |
    +-----------+----------------+
    | 44        | gpio_irq       |
    +-----------+----------------+
    | 35~38     | timer_irq      |
    +-----------+----------------+
    | 34        | pwm_int        |
    +-----------+----------------+
    | 32        | i2c_int        |
    +-----------+----------------+
    | 30        | uart1_irq      |
    +-----------+----------------+
    | 29        | uart0_irq      |
    +-----------+----------------+
    | 27        | spi_int        |
    +-----------+----------------+
    | 26        | efuse_int      |
    +-----------+----------------+
    | 25        | adc_int        |
    +-----------+----------------+
    | 23        | flash_int      |
    +-----------+----------------+
    | 19~20     | ir_remote_int  |
    +-----------+----------------+
    | 15        | dma_int        |
    +-----------+----------------+
    | 9~14      | sec_eng_int    |
    +-----------+----------------+
    | 7         | sdio_int       |
    +-----------+----------------+
    | 5~6       | rf_int         |
    +-----------+----------------+
    | 0~4       | err_int        |
    +-----------+----------------+