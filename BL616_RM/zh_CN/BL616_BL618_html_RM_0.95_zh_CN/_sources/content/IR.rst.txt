===========
IR
===========

简介
=====
红外遥控（Infrared remote，简称IR）是一种无线、非接触式控制技术，具有抗干扰能力强、信息传输可靠、功耗低、成本低等优点。红外遥控的发射电路是采用红外发光二极管来发出经过调制的红外光波；接收电路由红外接收二极管、三极管或硅光电池组成，它们将红外发射器发射的红外光转换为相应的电信号，再送至后置放大器。

主要特征
=========
 - 支持以固定协议NEC、RC-5接收数据
 - 支持以脉冲宽度计数方式接收任意格式数据
 - 接收最多支持64-bit数据位
 - 64*2字节的接收FIFO
 - 接收结束中断

功能描述
===========
固定协议接收
-------------
IR接收支持两种固定的协议，分别为NEC协议和RC-5协议。

- NEC协议

NEC协议的逻辑1与逻辑0波形如下图所示：

.. figure:: ../../picture/IRNecLogical.svg
   :align: center

   NEC逻辑波形

逻辑1周期为2.25ms，脉冲时间560us；逻辑0周期为1.12ms，脉冲时间560us。
NEC协议的具体格式如下图所示：

.. figure:: ../../picture/IRNec.svg
   :align: center

   NEC协议波形

头脉冲是9ms的载波脉冲和4.5ms的低电平，之后是8-bit的地址码及其反码，然后是8-bit的命令码及其反码，尾脉冲是560us载波与560us低电平。

- RC-5协议

RC-5协议的逻辑1与逻辑0波形如下图所示：

.. figure:: ../../picture/IRRc5Logical.svg
   :align: center

   RC5逻辑波形

逻辑1周期为1.778ms，先是889us的低电平后是889us的载波；逻辑0与逻辑1波形相反。
RC-5协议的具体格式如下图所示：

.. figure:: ../../picture/IRRc5.svg
   :align: center

   RC5协议波形

前两位为开始位，固定为逻辑1，第三位是翻转位，当一个键值发出然后再按下时该位会取反。之后5位是地址码与6位命令码。

需要注意的是，常见的红外一体接收头为了提高接收灵敏度，接收到高电平后输出的是低电平，所以在使用IR接收功能时要将接收翻转功能打开。

脉冲宽度接收
-------------
对于NEC、RC-5协议以外的其他任意格式的数据，IR会以其内部工作时钟去依次计数每个高或者低电平的持续时间，然后将数据存入到深度为64，宽度为2字节的接收FIFO之中。

IR中断
-------------
IR有单独的接收结束中断，在接收过程中，它会用内部工作时钟去计数每段电平维持的时间，一旦这个计数达到设定的结束阈值，就会产生接收结束中断。
可以通过寄存器IRRX_INT_STS查询接收中断状态和清除中断。

.. only:: html

   .. include:: ir_register.rst

.. raw:: latex

   \input{../../zh_CN/content/ir}