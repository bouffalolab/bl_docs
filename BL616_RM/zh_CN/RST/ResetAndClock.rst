============
复位和时钟
============
简介
========
芯片内的时钟源：XTAL，PLL，RC，搭配分频等配置送至各模块。


.. _reset-management-label:

复位管理
===========
芯片复位包括：

- CPU复位：仅仅复位CPU模块，程序会重新运行，外设不会被复位

- 系统复位：各个外设和CPU会被复位，但是AON域的相关寄存器不会被复位

- 上电复位：整个系统包括AON域的相关寄存器都会被复位

应用程序可以根据需要，选择使用对应的复位方式。

.. table:: 软件复位功能表 

    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | BL616      | RST_PIN/ Watch Dog/ PDS/             | Software Reset    | System Reset (swrst_cfg2[2])/ | CPU Reset (swrst_cfg2[1])/ |
    |            +                                      +                   +                               +                            +
    |            | Software Power On (swrst_cfg2[0])    | (swrst_cfg1)      | PDS                           | PDS                        |
    +============+======================================+===================+===============================+============================+
    | CPU        | ✔                                    |                   |                               | ✔                          |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | bus        | ✔                                    |                   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | glb        | ✔                                    | swrst_s1[0]       |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | mix        | ✔                                    | swrst_s1[1]       |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | gpip       | ✔                                    | swrst_s1[2]       | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | sec_eng    | ✔                                    | swrst_s1[4]       | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | tz         | ✔                                    |                   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | efuse      | ✔                                    |                   |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | dma        | ✔                                    | swrst_s1[12]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | sdu/usb    | ✔                                    | swrst_s1[13]      |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | mm_misc    | ✔                                    | swrst_s1_ext[1]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | psram_ctrl | ✔                                    | swrst_s1_ext[2]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | usb        | ✔                                    | swrst_s1_ext[3]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | AUDIO DAC  | ✔                                    | swrst_s1_ext[5]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | sdh        | ✔                                    | swrst_s1_ext[6]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | emac       | ✔                                    | swrst_s1_ext[7]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | pds        |                                      | swrst_s1[14]      |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | uart0      | ✔                                    | swrst_s1a[0]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | uart1      | ✔                                    | swrst_s1a[1]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | spi        | ✔                                    | swrst_s1a[2]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | i2c0       | ✔                                    | swrst_s1a[3]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | pwm        | ✔                                    | swrst_s1a[4]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | timer      | ✔                                    | swrst_s1a[5]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | irr        | ✔                                    | swrst_s1a[6]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | cks        | ✔                                    | swrst_s1a[7]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | dbi        | ✔                                    | swrst_s1a[8]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | i2c1       | ✔                                    | swrst_s1a[9]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | I2S        | ✔                                    | swrst_s1a[11]     | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | AUDIO ADC  | ✔                                    | swrst_s1a[12]     | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | Wi-Fi      | ✔                                    | swrst_s2[0]       |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | ble        | ✔                                    | swrst_s3[0][2]    |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+


时钟源
===========

时钟源包含：

- XTAL   ：外部晶振时钟，视系统需求频率可选 24、26、32、38.4、40MHz
- XTAL32K：外部晶振时钟，频率 32768 Hz
- RC32K  ：RC振荡器时钟，频率 32768 Hz，提供校准
- RC32M  ：RC振荡器时钟，频率 32MHz，提供校准
- PLL    ：多个 PLL 模块，可以产生若干不同频率的时钟，以满足各个应用场景

时钟控制单元将来自振荡器的时钟分配给内核和外围设备，可通过选择系统时钟源，动态分频进行时钟配置。睡眠使用 32kHz 时钟，以达到低功耗时钟管理。

外围设备时钟包括: Flash、UART、I2C、SPI、PWM、IR-remote、GPADC、GPDAC 等。

 .. figure:: ../../picture/clock_tree.svg
    :align: center
    :scale: 50%
 
    时钟架构


