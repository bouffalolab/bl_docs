<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>21. MJPEG &mdash; BL616/BL618 Reference Manual  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="22. DBI" href="DBI.html" />
    <link rel="prev" title="20. CAM" href="Cam.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> BL616/BL618 Reference Manual
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="SystemAndMemoryOverview.html">1. System and Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="ResetAndClock.html">2. Reset and Clock</a></li>
<li class="toctree-l1"><a class="reference internal" href="GLB.html">3. GLB</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPIO.html">4. GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="ADC.html">5. ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="DAC.html">6. DAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="DMA.html">7. DMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="IR.html">8. IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPI.html">9. SPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="UART.html">10. UART</a></li>
<li class="toctree-l1"><a class="reference internal" href="I2C.html">11. I2C</a></li>
<li class="toctree-l1"><a class="reference internal" href="PWM.html">12. PWM</a></li>
<li class="toctree-l1"><a class="reference internal" href="TIMER.html">13. TIMER</a></li>
<li class="toctree-l1"><a class="reference internal" href="I2S.html">14. I2S</a></li>
<li class="toctree-l1"><a class="reference internal" href="AudioDAC.html">15. AudioDAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="AudioADC.html">16. AudioADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="EMAC.html">17. Emac</a></li>
<li class="toctree-l1"><a class="reference internal" href="USB.html">18. USB</a></li>
<li class="toctree-l1"><a class="reference internal" href="ISO11898.html">19. ISO11898</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cam.html">20. CAM</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">21. MJPEG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">21.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#features">21.2. Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#function-description">21.3. Function description</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-configuration">21.3.1. Input configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quantization-coefficient-table">21.3.2. Quantization coefficient table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#software-mode-and-link-mode">21.3.3. Software mode and link mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#swap-mode">21.3.4. Swap mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kick-mode">21.3.5. Kick mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jpg-function">21.3.6. Jpg function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cache-image-information">21.3.7. Cache image information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#support-a-variety-of-interrupt-information-can-be-configured-independently-of-the-switch">21.3.8. Support a variety of interrupt information (can be configured independently of the switch)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="DBI.html">22. DBI</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDH.html">23. SDH</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDIO.html">24. SDIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="LowPower.html">25. LowPower</a></li>
<li class="toctree-l1"><a class="reference internal" href="SEC_ENG.html">26. SEC ENG</a></li>
<li class="toctree-l1"><a class="reference internal" href="version.html">27. Revision history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BL616/BL618 Reference Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">21. </span>MJPEG</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mjpeg">
<h1><span class="section-number">21. </span>MJPEG<a class="headerlink" href="#mjpeg" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2><span class="section-number">21.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>MJPEG (Motion Joint Photographic Experts Group) is a video coding format that can be accurate to frame editing and multi-layer image processing. It handles motion video sequences as continuous still images. This compression method compresses each frame individually and completely. . By compressing the original data in YCbCr format, the memory space occupied by one frame of image can be greatly reduced.</p>
</section>
<section id="features">
<h2><span class="section-number">21.2. </span>Features<a class="headerlink" href="#features" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Configurable input formats including:</p>
<blockquote>
<div><ul class="simple">
<li><p>YCbCr4:2:2 plane or packed mode</p></li>
<li><p>YCbCr4:2:0 plane mode</p></li>
<li><p>YCbCr4:0:0</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Configurable input data Y, Cb, Cr sort order</p></li>
<li><p>Quantization coefficient table can be freely configured</p></li>
<li><p>Support software mode and linkage mode</p></li>
<li><p>Support swap mode</p></li>
<li><p>Support kick mode</p></li>
<li><p>Reserve jpg head space and automatically add jpg tail</p></li>
<li><p>Continuously cache up to 4 sets of picture information</p></li>
<li><p>A variety of application interruptions are conducive to flexible use and error prompts</p></li>
</ul>
</section>
<section id="function-description">
<h2><span class="section-number">21.3. </span>Function description<a class="headerlink" href="#function-description" title="Permalink to this headline"></a></h2>
<section id="input-configuration">
<h3><span class="section-number">21.3.1. </span>Input configuration<a class="headerlink" href="#input-configuration" title="Permalink to this headline"></a></h3>
<p>The YCbCr format of the input data can be selected by bit &lt;REG_YUV_MODE&gt; of register MJPEG_CONTROL_1, including YCbCr4:2:2 plane or packed mode, YCbCr4:2:0 plane mode and YCbCr4:0:0 grayscale image. When the YCbCr4:2:2 packing mode is selected, the arrangement order of Y, Cb and Cr can be configured through the upper 8 bits of the register MJPEG_HEADER_BYTE. When other modes are selected, the order of Cb and Cr can be set by bit &lt;REG_ORDER_U_EVEN&gt; of register MJPEG_CONTROL_1. The detailed configuration is shown in the figure below.</p>
<figure class="align-center">
<img alt="../_images/MJPEGYUYVInterleaveOrderConfiguration.svg" src="../_images/MJPEGYUYVInterleaveOrderConfiguration.svg" /></figure>
</section>
<section id="quantization-coefficient-table">
<h3><span class="section-number">21.3.2. </span>Quantization coefficient table<a class="headerlink" href="#quantization-coefficient-table" title="Permalink to this headline"></a></h3>
<p>The quantization coefficient table can be freely configured by the user, &lt;reg_q_0_00&gt; to &lt;reg_q_0_3F&gt; represent the quantization tables of the Y component of grayscale information, and &lt;reg_q_1_00&gt; to &lt;reg_q_1_3F&gt; represent the quantization tables of the chrominance information Cb and Cr. The quantization table is arranged in the order from the upper left corner to the bottom, the first column is followed by the second column, that is, reg_q_0_00 represents the quantization value of the first row and the first column of the Y component, and reg_q_0_01 represents the quantization of the second row and the first column of the Y component. Value, reg_q_0_07 represents the quantized value of the Y component in the eighth row and first column, reg_q_0_08 represents the quantized value in the first row and second column of the Y component, and so on.</p>
</section>
<section id="software-mode-and-link-mode">
<h3><span class="section-number">21.3.3. </span>Software mode and link mode<a class="headerlink" href="#software-mode-and-link-mode" title="Permalink to this headline"></a></h3>
<p>When the bit &lt;REG_MJPEG_SW_MODE&gt; of the MJPEG_CONTROL_2 register is set to 1, the software mode is enabled. In this mode, MJPEG will read the original image data of the specified number of frames from the memory for compression. In this mode, the image data needs to be prepared in advance.</p>
<p>When the bit &lt;REG_MJPEG_SW_MODE&gt; of the MJPEG_CONTROL_2 register is cleared to 0, the linkage mode is enabled. In this mode, MJPEG will process the output of the CAM module as its input. MJPEG is processed with 8*8 data blocks as a unit. When the CAM finishes writing 8 lines of data to the memory, MJPEG will start to work, and the memory space processed by MJPEG will be released to the CAM for reuse, so that the CAM can complete the linkage with MJPEG without the memory space of a whole picture.</p>
</section>
<section id="swap-mode">
<h3><span class="section-number">21.3.4. </span>Swap mode<a class="headerlink" href="#swap-mode" title="Permalink to this headline"></a></h3>
<p>When using swap mode, the MJPEG storage space will be evenly divided into two blocks, when MJPEG finishes writing one block, an interrupt will be generated to notify the software to read the data, and it will write the data to the other block. Alternate use back and forth, so as to use less than one frame of picture storage space for data processing.</p>
</section>
<section id="kick-mode">
<h3><span class="section-number">21.3.5. </span>Kick mode<a class="headerlink" href="#kick-mode" title="Permalink to this headline"></a></h3>
<p>The kick mode is enabled when bit &lt;REG_SW_KICK_MODE&gt; of the MJPEG_CONTROL_2 register is set to 1. In this mode, each time a 1 is written to the bit &lt;REG_SW_KICK&gt; of the MJPEG_CONTROL_2 register, a compression is started. The number of compressed lines is determined by the bit &lt;REG_SW_KICK_HBLK&gt; of the MJPEG_YUV_MEM_SW register. It should be noted that the kick mode can only be used in software mode, not in linkage mode.</p>
</section>
<section id="jpg-function">
<h3><span class="section-number">21.3.6. </span>Jpg function<a class="headerlink" href="#jpg-function" title="Permalink to this headline"></a></h3>
<p>The jpg function will automatically reserve a certain number of bytes of space at the beginning of each frame of data and fill it with the specified data. The size of this space is set by the lower 12 bits of the register MJPEG_HEADER_BYTE. There is 768 bytes of memory at offset 0x800 for storing the data that needs to be filled at the beginning of each frame. The user only needs to write the jpg header information into it, and this information will be included at the beginning of each frame of data generated. In addition, if the auto-fill jpg end is enabled, two bytes of data will be added at the end of each frame of data, and the value of these two bytes is 0xFFD9.</p>
</section>
<section id="cache-image-information">
<h3><span class="section-number">21.3.7. </span>Cache image information<a class="headerlink" href="#cache-image-information" title="Permalink to this headline"></a></h3>
<p>The module contains 4 groups of FIFO to record the picture address, picture size and picture ID. Whenever this module completely writes a frame to the memory, it will record the start address, image size and image ID of the frame image in this FIFO, but it should be noted that when the memory is insufficient, or there are 4 sets of FIFO When the storage is full, the module will automatically discard the information of the next picture. In the part where the picture information is taken out, the pop action can be performed through the APB interface to empty the oldest picture information. At this time, the FIFO will be automatically advanced to ensure the FIFO. Timing of internal picture information.</p>
</section>
<section id="support-a-variety-of-interrupt-information-can-be-configured-independently-of-the-switch">
<h3><span class="section-number">21.3.8. </span>Support a variety of interrupt information (can be configured independently of the switch)<a class="headerlink" href="#support-a-variety-of-interrupt-information-can-be-configured-independently-of-the-switch" title="Permalink to this headline"></a></h3>
<ol class="upperalpha simple">
<li><p>Normal interrupt - can be set to interrupt after writing several pictures</p></li>
<li><p>Camera Interrupt - When the speed of MJPEG processing cannot keep up with the speed of CAM module writing, and the CAM overflows, an interrupt is issued</p></li>
<li><p>Memory interrupt - when the memory is overwritten, an interrupt is issued</p></li>
<li><p>Frame interrupt - when there are more than 4 groups of unprocessed pictures, an interrupt is issued</p></li>
<li><p>Swap interrupt - when a memory block is full in swap mode, an interrupt is issued</p></li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Cam.html" class="btn btn-neutral float-left" title="20. CAM" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="DBI.html" class="btn btn-neutral float-right" title="22. DBI" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>