============
Reset and Clock
============
Overview
========
The clock sources in the chip include XTAL, PLL, and RC. They are sent to each module along with frequency division configuration.

.. _reset-management-label:

Reset Management
===========

Chip reset:

- CPU reset: Only CPU is reset. The program will roll back, and peripherals will not be reset
- System reset: All peripherals and CPUs will be reset, but the registers in the AON field will not be reset
- Power-on reset: The whole system including the registers in the AON field will be reset

The application can select a proper reset mode as required.

.. table:: Software reset function table 

    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | BL616      | RST_PIN/ Watch Dog/ PDS/             | Software Reset    | System Reset (swrst_cfg2[2])/ | CPU Reset (swrst_cfg2[1])/ |
    |            +                                      +                   +                               +                            +
    |            | Software Power On (swrst_cfg2[0])    | (swrst_cfg1)      | PDS                           | PDS                        |
    +============+======================================+===================+===============================+============================+
    | CPU        | ✔                                    |                   |                               | ✔                          |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | BUS        | ✔                                    |                   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | GLB        | ✔                                    | swrst_s1[0]       |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | MIX        | ✔                                    | swrst_s1[1]       |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | GPIP       | ✔                                    | swrst_s1[2]       | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | SEC_ENG    | ✔                                    | swrst_s1[4]       | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | TZ         | ✔                                    |                   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | Efuse      | ✔                                    |                   |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | DMA        | ✔                                    | swrst_s1[12]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | SDU/USB    | ✔                                    | swrst_s1[13]      |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | MM_MISC    | ✔                                    | swrst_s1_ext[1]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | pSRAM_ctrl | ✔                                    | swrst_s1_ext[2]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | USB        | ✔                                    | swrst_s1_ext[3]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | AUDIO DAC  | ✔                                    | swrst_s1_ext[5]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | SDH        | ✔                                    | swrst_s1_ext[6]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | EMAC       | ✔                                    | swrst_s1_ext[7]   | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | PDS        |                                      | swrst_s1[14]      |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | UART0      | ✔                                    | swrst_s1a[0]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | UART1      | ✔                                    | swrst_s1a[1]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | SPI        | ✔                                    | swrst_s1a[2]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | I2C0       | ✔                                    | swrst_s1a[3]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | PWM        | ✔                                    | swrst_s1a[4]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | TIMER      | ✔                                    | swrst_s1a[5]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | IRR        | ✔                                    | swrst_s1a[6]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | CKS        | ✔                                    | swrst_s1a[7]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | DBI        | ✔                                    | swrst_s1a[8]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | I2C1       | ✔                                    | swrst_s1a[9]      | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | I2S        | ✔                                    | swrst_s1a[11]     | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | AUDIO ADC  | ✔                                    | swrst_s1a[12]     | ✔                             |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | Wi-Fi      | ✔                                    | swrst_s2[0]       |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+
    | BLE        | ✔                                    | swrst_s3[0][2]    |                               |                            |
    +------------+--------------------------------------+-------------------+-------------------------------+----------------------------+


Clock Source
===========

Types:

- XTAL: external crystal oscillator clock, with optional frequencies of 24, 26, 32, 38.4, and 40 MHz depending on system requirements
- XTAL32K: external crystal oscillator clock, with frequency of 32768 Hz
- RC32K: RC oscillator clock with frequency of 32768 Hz and calibration
- RC32M: RC oscillator clock with frequency of 32 MHz and calibration
- PLL: multiple PLL modules, which can generate several clocks with different frequencies to meet various application scenarios

The clock control unit distributes the clocks from the oscillator to the core and peripheral devices. You can choose the system clock source, dynamic frequency divider, and clock configuration, and use the 32 kHz clock in sleep to achieve low-power clock management.

Peripheral clocks include Flash, UART, I2C, SPI, PWM, IR-remote, GPADC, and GPDAC.

.. figure:: ../../picture/clock_tree.svg
   :align: center
   :scale: 45%

   Clock Architecture


