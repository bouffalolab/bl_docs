<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>8. DMA2D &mdash; BL808 Reference Manual  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. LZ4D" href="Lz4d.html" />
    <link rel="prev" title="7. DMA" href="DMA.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> BL808 Reference Manual
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="SystemAndMemoryOverview.html">1. System and Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="ResetAndClock.html">2. Reset and Clock</a></li>
<li class="toctree-l1"><a class="reference internal" href="GLB.html">3. GLB</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPIO.html">4. GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="ADC.html">5. ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="DAC.html">6. DAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="DMA.html">7. DMA</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">8. DMA2D</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">8.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#features">8.2. Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functional-description">8.3. Functional Description</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#operating-principle">8.3.1. Operating Principle</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-translation">8.3.2. Image Translation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-rotation">8.3.3. Image Rotation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-folding">8.3.4. Image Folding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#image-filling">8.3.5. Image Filling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#color-key">8.3.6. Color Key</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Lz4d.html">9. LZ4D</a></li>
<li class="toctree-l1"><a class="reference internal" href="DBI.html">10. DBI</a></li>
<li class="toctree-l1"><a class="reference internal" href="DPI.html">11. DPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="DSI.html">12. DSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cam.html">13. CAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="IR.html">14. IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPI.html">15. SPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="UART.html">16. UART</a></li>
<li class="toctree-l1"><a class="reference internal" href="I2C.html">17. I2C</a></li>
<li class="toctree-l1"><a class="reference internal" href="PWM.html">18. PWM</a></li>
<li class="toctree-l1"><a class="reference internal" href="TIMER.html">19. TIMER</a></li>
<li class="toctree-l1"><a class="reference internal" href="I2s.html">20. I2S</a></li>
<li class="toctree-l1"><a class="reference internal" href="PDM.html">21. PDM</a></li>
<li class="toctree-l1"><a class="reference internal" href="AUDIO.html">22. AUDIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="PSRAM.html">23. PSRAM Contorller</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emac.html">24. Emac</a></li>
<li class="toctree-l1"><a class="reference internal" href="USB.html">25. USB</a></li>
<li class="toctree-l1"><a class="reference internal" href="ISO11898.html">26. ISO11898</a></li>
<li class="toctree-l1"><a class="reference internal" href="MJPEG.html">27. MJPEG</a></li>
<li class="toctree-l1"><a class="reference internal" href="JDEC.html">28. JDEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="VENC.html">29. VENC</a></li>
<li class="toctree-l1"><a class="reference internal" href="NPUtoolchain.html">30. NPU toolchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="NPU.html">31. NPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="IPC.html">32. IPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="LowPower.html">33. LowPower</a></li>
<li class="toctree-l1"><a class="reference internal" href="SEC_ENG.html">34. SEC ENG</a></li>
<li class="toctree-l1"><a class="reference internal" href="version.html">35. Revision history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BL808 Reference Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">8. </span>DMA2D</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="dma2d">
<h1><span class="section-number">8. </span>DMA2D<a class="headerlink" href="#dma2d" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2><span class="section-number">8.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>The 2 Dimensional Direct Memory Access (DMA2D or 2D DMA) is a technique extended from 1D DMA that allows a 2D DMA controller to transfer data in the set strides (see the DMA section for details about 1D DMA). The memory address of data can be non-contiguous, incremented or decremented at a certain interval, or unchanged. The 2D DMA controller has 2 independent dedicated lanes, managing data transmission between peripherals and memory to enhance bus efficiency. It supports the transfer from memory to memory, memory to peripherals, and peripheral to memory, and provides the LLI linked list function.</p>
</section>
<section id="features">
<h2><span class="section-number">8.2. </span>Features<a class="headerlink" href="#features" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Two dedicated independent lanes</p></li>
<li><p>Configurable as 1D DMA or 2D DMA</p></li>
<li><p>Independent control source and destination access width (single byte, double bytes, and four bytes)</p></li>
<li><p>Each lane acts as a read-write cache independently</p></li>
<li><p>Each lane can be triggered by independent peripheral hardware or software</p></li>
<li><p>Supported peripherals: UART, I2C, SPI, DBI, and DSI</p></li>
<li><p>Eight kinds of process control</p>
<ul>
<li><p>DMA process control, source memory, destination memory</p></li>
<li><p>DMA process control, source memory, destination peripherals</p></li>
<li><p>DMA process control, source peripherals, destination memory</p></li>
<li><p>DMA process control, source peripherals, destination peripherals</p></li>
<li><p>Destination peripheral process control, source peripherals, destination peripherals</p></li>
<li><p>Destination peripheral process control, source memory, destination peripherals</p></li>
<li><p>Source peripheral process control, source peripherals, destination memory</p></li>
<li><p>Source peripheral process control, source peripherals, destination peripherals</p></li>
</ul>
</li>
<li><p>Supports the LLI linked list function to improve DMA efficiency, and configures whether to trigger interrupt for each node separately</p></li>
<li><p>Exclusive features of 2D DMA:</p>
<ul>
<li><p>Supports translation of 8/16/32-bit images in any direction</p></li>
<li><p>Supports rotation of 8/16/32-bit images at 90°/180°/270°</p></li>
<li><p>Supports horizontal/vertical folding of 8/16/32-bit images</p></li>
<li><p>Supports filling by 8/16/32-bit images</p></li>
<li><p>Supports 8/16/24/32-bit Color Key</p></li>
</ul>
</li>
</ul>
</section>
<section id="functional-description">
<h2><span class="section-number">8.3. </span>Functional Description<a class="headerlink" href="#functional-description" title="Permalink to this headline"></a></h2>
<section id="operating-principle">
<h3><span class="section-number">8.3.1. </span>Operating Principle<a class="headerlink" href="#operating-principle" title="Permalink to this headline"></a></h3>
<p>On the basis of 1D DMA, 2D DMA adds the SRC XINCR, SRC XCOUNT, SRC YINCR, and SRC YCOUNT; and adds the DEST XINCR, DEST XCOUNT, and DEST YINCR. DEST YCOUNT will not be configured, as it will be derived from other values. Here the stride value can be negative. The 2D DMA transfer can be viewed as a nested loop, where the outer loop is specified by YCOUNT and each time the loop address increments by YINCR bytes (decrements when YINCR is negative); the inner loop is specified by XCOUNT and each time the loop address increments XINCR bytes (decrements when XINCR is negative). The working principle is illustrated as follows:</p>
<figure class="align-center" id="id1">
<img alt="../_images/DMA2DMemory.svg" src="../_images/DMA2DMemory.svg" /><figcaption>
<p><span class="caption-number">Fig. 8.1 </span><span class="caption-text">Operating Principle</span><a class="headerlink" href="#id1" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="image-translation">
<h3><span class="section-number">8.3.2. </span>Image Translation<a class="headerlink" href="#image-translation" title="Permalink to this headline"></a></h3>
<p>If the memory data is considered as a rectangular image, the image can be translated by setting the stride and loop values, as shown below:</p>
<figure class="align-center" id="id2">
<img alt="../_images/DMA2DTranslate.svg" src="../_images/DMA2DTranslate.svg" /><figcaption>
<p><span class="caption-number">Fig. 8.2 </span><span class="caption-text">Image Translation</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>As shown in the figure, it is assumed that a pixel width (P) is 8 bit, and the transfer width of 2D DMA is set to 8 bit. In an M × N image (30 × 8 in the figure), a rectangular area of W × H (3 × 5 in the figure) is translated from the coordinate (x1, y1) [(3, 1) in the figure] to the coordinate (x2, y2) [(21, 2) in the figure]. The start address of image data starts from addr0 (0 in the figure). Relevant parameters of 2D DMA are calculated as follows:</p>
<ul class="simple">
<li><p>SRC ADDR START = addr0+(M*y1+x1)*P = 0+(30*1+3)*1 = 33</p></li>
<li><p>SRC XINCR = P = 1</p></li>
<li><p>SRC XCOUNT = W = 3</p></li>
<li><p>SRC YINCR = (M-(W-1))*P = (30-(3-1))*1 = 28</p></li>
<li><p>SRC YCOUNT = H = 5</p></li>
<li><p>DEST ADDR START = addr0+(M*y2+x2)*P = 0+(30*2+21)*1 = 81</p></li>
<li><p>DEST XINCR = P = 1</p></li>
<li><p>DEST XCOUNT = W = 3</p></li>
<li><p>DEST YINCR = (M-(W-1))*P = (30-(3-1))*1 = 28</p></li>
</ul>
</section>
<section id="image-rotation">
<h3><span class="section-number">8.3.3. </span>Image Rotation<a class="headerlink" href="#image-rotation" title="Permalink to this headline"></a></h3>
<p>If the memory data is considered as a rectangular image, the image can be rotated at 90°/180°/270° by setting the stride and loop values, as shown below:</p>
<figure class="align-center" id="id3">
<img alt="../_images/DMA2DRotate.svg" src="../_images/DMA2DRotate.svg" /><figcaption>
<p><span class="caption-number">Fig. 8.3 </span><span class="caption-text">Image Rotation</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>As shown in the figure, it is assumed that a pixel width (P) is 8 bit, and the transfer width of 2D DMA is set to 8 bit. In an M × N image (30 × 8 in the figure), a rectangular area of W × H (3 × 5 in the figure) is rotated clockwise at 90° from the coordinate (x1, y1) [(3, 1) in the figure] to the coordinate (x2, y2) [(14,5) in the figure]. The start address of image data starts from addr0 (0 in the figure). Relevant parameters of 2D DMA are calculated as follows:</p>
<ul class="simple">
<li><p>SRC ADDR START = addr0+(M*y1+x1)*P = 0+(30*1+3)*1 = 33</p></li>
<li><p>SRC XINCR = P = 1</p></li>
<li><p>SRC XCOUNT = W = 3</p></li>
<li><p>SRC YINCR = (M-(W-1))*P = (30-(3-1))*1 = 28</p></li>
<li><p>SRC YCOUNT = H = 5</p></li>
<li><p>DEST ADDR START = addr0+(M*y2+x2)*P = 0+(30*5+14)*1 = 164</p></li>
<li><p>DEST XINCR = M*P = 30*1 = 30</p></li>
<li><p>DEST XCOUNT = W = 3</p></li>
<li><p>DEST YINCR = -(M*(W-1)+1)*P = -(30*(3-1)+1)*1 = -61</p></li>
</ul>
<p>For the clockwise rotation of the rectangular area at 180° from the coordinate (x1, y1) [(3, 1) in the figure] to the coordinate (x3, y3) [(19, 7) in the figure], relevant parameters are calculated as follows:</p>
<ul class="simple">
<li><p>SRC ADDR START = addr0+(M*y1+x1)*P = 0+(30*1+3)*1 = 33</p></li>
<li><p>SRC XINCR = P = 1</p></li>
<li><p>SRC XCOUNT = W = 3</p></li>
<li><p>SRC YINCR = (M-(W-1))*P = (30-(3-1))*1 = 28</p></li>
<li><p>SRC YCOUNT = H = 5</p></li>
<li><p>DEST ADDR START = addr0+(M*y3+x3)*P = 0+(30*7+19)*1 = 229</p></li>
<li><p>DEST XINCR = -P = -1</p></li>
<li><p>DEST XCOUNT = W = 3</p></li>
<li><p>DEST YINCR = -(M-(W-1))*P = -(30-(3-1))*1 = -28</p></li>
</ul>
<p>For the clockwise rotation of the rectangular area at 270° from the coordinate (x1, y1) [(3, 1) in the figure] to the coordinate (x4, y4) [(24, 2) in the figure], relevant parameters are calculated as follows:</p>
<ul class="simple">
<li><p>SRC ADDR START = addr0+(M*y1+x1)*P = 0+(30*1+3)*1 = 33</p></li>
<li><p>SRC XINCR = P = 1</p></li>
<li><p>SRC XCOUNT = W = 3</p></li>
<li><p>SRC YINCR = (M(W1))*P = (30(31))*1 = 28</p></li>
<li><p>SRC YCOUNT = H = 5</p></li>
<li><p>DEST ADDR START = addr0+(M*y4+x4)*P = 0+(30*2+24)*1 = 84</p></li>
<li><p>DEST XINCR = -M*P = -30*1 = -30</p></li>
<li><p>DEST XCOUNT = W = 3</p></li>
<li><p>DEST YINCR = (M*(W-1)+1)*P = (30*(3-1)+1)*1 = 61</p></li>
</ul>
</section>
<section id="image-folding">
<h3><span class="section-number">8.3.4. </span>Image Folding<a class="headerlink" href="#image-folding" title="Permalink to this headline"></a></h3>
<p>If the memory data is considered as a rectangular image, the image can be folded horizontally or vertically by setting the stride and loop values, as shown below:</p>
<figure class="align-center" id="id4">
<img alt="../_images/DMA2DFold.svg" src="../_images/DMA2DFold.svg" /><figcaption>
<p><span class="caption-number">Fig. 8.4 </span><span class="caption-text">Image Folding</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>As shown in the figure, it is assumed that a pixel width (P) is 8 bit, and the transfer width of 2D DMA is set to 8 bit. In an M × N image (30 × 8 in the figure), a rectangular area of W × H (3 × 5 in the figure) is folded horizontally from the coordinate (x1, y1) [(3, 1) in the figure] to the coordinate (x2, y2) [(15, 3) in the figure]. The start address of image data starts from addr0 (0 in the figure). Relevant parameters of 2D DMA are calculated as follows:</p>
<ul class="simple">
<li><p>SRC ADDR START = addr0+(M*y1+x1)*P = 0+(30*1+3)*1 = 33</p></li>
<li><p>SRC XINCR = P = 1</p></li>
<li><p>SRC XCOUNT = W = 3</p></li>
<li><p>SRC YINCR = (M-(W-1))*P = (30-(3-1))*1 = 28</p></li>
<li><p>SRC YCOUNT = H = 5</p></li>
<li><p>DEST ADDR START = addr0+(M*y2+x2)*P = 0+(30*3+15)*1 = 105</p></li>
<li><p>DEST XINCR = -P = -1</p></li>
<li><p>DEST XCOUNT = W = 3</p></li>
<li><p>DEST YINCR = (M+(W-1))*P = (30+(3-1))*1 = 32</p></li>
</ul>
<p>For vertical folding of the rectangular area from the coordinate (x1, y1) [(3, 1) in the figure] to the coordinate (x3, y3) [(22, 4) in the figure], relevant parameters are calculated as follows:</p>
<ul class="simple">
<li><p>SRC ADDR START = addr0+(M*y1+x1)*P = 0+(30*1+3)*1 = 33</p></li>
<li><p>SRC XINCR = P = 1</p></li>
<li><p>SRC XCOUNT = W = 3</p></li>
<li><p>SRC YINCR = (M-(W-1))*P = (30-(3-1))*1 = 28</p></li>
<li><p>SRC YCOUNT = H = 5</p></li>
<li><p>DEST ADDR START = addr0+(M*y3+x3)*P = 0+(30*4+22)*1 = 142</p></li>
<li><p>DEST XINCR = P = 1</p></li>
<li><p>DEST XCOUNT = W = 3</p></li>
<li><p>DEST YINCR = -(M+(W-1))*P = -(30+(3-1))*1 = -32</p></li>
</ul>
</section>
<section id="image-filling">
<h3><span class="section-number">8.3.5. </span>Image Filling<a class="headerlink" href="#image-filling" title="Permalink to this headline"></a></h3>
<p>If the memory data is considered as a rectangular image, the image can be filled by setting the stride and loop values, as shown below:</p>
<figure class="align-center" id="id5">
<img alt="../_images/DMA2DFill.svg" src="../_images/DMA2DFill.svg" /><figcaption>
<p><span class="caption-number">Fig. 8.5 </span><span class="caption-text">Image Filling</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>As shown in the figure, it is assumed that a pixel width (P) is 8 bit, and the transfer width of 2D DMA is set to 8 bit. In an M × N image (30 × 8 in the figure), a rectangular area of W × H (3 × 5 in the figure) with starting coordinate (x2, y2) [(19, 2) in the figure] is filled by the value of the coordinate (x1, y1) [(3, 1) in the figure]. The start address of image data starts from addr0 (0 in the figure). Relevant parameters of 2D DMA are calculated as follows:</p>
<ul class="simple">
<li><p>SRC ADDR START = addr0+(M*y1+x1)*P = 0+(30*1+3)*1 = 33</p></li>
<li><p>SRC XINCR = 0</p></li>
<li><p>SRC XCOUNT = W = 3</p></li>
<li><p>SRC YINCR = 0</p></li>
<li><p>SRC YCOUNT = H = 5</p></li>
<li><p>DEST ADDR START = addr0+(M*y2+x2)*P = 0+(30*2+19)*1 = 79</p></li>
<li><p>DEST XINCR = P = 1</p></li>
<li><p>DEST XCOUNT = W = 3</p></li>
<li><p>DEST YINCR = (M-(W-1))*P = (30-(3-1))*1 = 28</p></li>
</ul>
</section>
<section id="color-key">
<h3><span class="section-number">8.3.6. </span>Color Key<a class="headerlink" href="#color-key" title="Permalink to this headline"></a></h3>
<p>When Color Key is enabled, if 2D DMA encounters a value equal to the preset Color Key value during data transfer, it skips the value and the original value is still stored in the skipped address. The width of Color Key can be set to 8/16/24/32-bit. The working principle is shown below:</p>
<figure class="align-center" id="id6">
<img alt="../_images/DMA2DColorKey.svg" src="../_images/DMA2DColorKey.svg" /><figcaption>
<p><span class="caption-number">Fig. 8.6 </span><span class="caption-text">Color Key</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>As shown in the above figure, the width of Color Key is set to 8 bit and the Key value is set to 0x55. When transferring the F-shaped rectangular area, 2D DMA skips the 0x55 value. So it can be seen from the right side that only the F-shaped rectangular area is transferred and the area that contains the 0x55 value is not transferred.</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="DMA.html" class="btn btn-neutral float-left" title="7. DMA" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Lz4d.html" class="btn btn-neutral float-right" title="9. LZ4D" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>