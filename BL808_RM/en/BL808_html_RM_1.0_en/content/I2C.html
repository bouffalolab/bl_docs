<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>17. I2C &mdash; BL808 Reference Manual  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="18. PWM" href="PWM.html" />
    <link rel="prev" title="16. UART" href="UART.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> BL808 Reference Manual
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="SystemAndMemoryOverview.html">1. System and Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="ResetAndClock.html">2. Reset and Clock</a></li>
<li class="toctree-l1"><a class="reference internal" href="GLB.html">3. GLB</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPIO.html">4. GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="ADC.html">5. ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="DAC.html">6. DAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="DMA.html">7. DMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="DMA2D.html">8. DMA2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lz4d.html">9. LZ4D</a></li>
<li class="toctree-l1"><a class="reference internal" href="DBI.html">10. DBI</a></li>
<li class="toctree-l1"><a class="reference internal" href="DPI.html">11. DPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="DSI.html">12. DSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cam.html">13. CAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="IR.html">14. IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPI.html">15. SPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="UART.html">16. UART</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">17. I2C</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">17.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#features">17.2. Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functional-description">17.3. Functional Description</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#start-and-stop-conditions">17.3.1. Start and stop conditions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-transfer-format">17.3.2. Data Transfer Format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arbitration">17.3.3. Arbitration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#i2c-clock-setting">17.4. I2C Clock Setting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#i2c-configuration-flow">17.5. I2C Configuration Flow</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#configuration-items">17.5.1. Configuration Items</a></li>
<li class="toctree-l3"><a class="reference internal" href="#read-write-flag-bit">17.5.2. Read/Write Flag Bit</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slave-address">17.5.3. Slave Address</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slave-register-address">17.5.4. Slave Register Address</a></li>
<li class="toctree-l3"><a class="reference internal" href="#slave-register-address-length">17.5.5. Slave Register Address Length</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data">17.5.6. Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-length">17.5.7. Data Length</a></li>
<li class="toctree-l3"><a class="reference internal" href="#enable-signal">17.5.8. Enable Signal</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fifo-management">17.6. FIFO Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="#use-with-dma">17.7. Use with DMA</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#dma-sending-flow">17.7.1. DMA Sending Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dma-receiving-flow">17.7.2. DMA Receiving Flow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#interrupt">17.8. Interrupt</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="PWM.html">18. PWM</a></li>
<li class="toctree-l1"><a class="reference internal" href="TIMER.html">19. TIMER</a></li>
<li class="toctree-l1"><a class="reference internal" href="I2s.html">20. I2S</a></li>
<li class="toctree-l1"><a class="reference internal" href="PDM.html">21. PDM</a></li>
<li class="toctree-l1"><a class="reference internal" href="AUDIO.html">22. AUDIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="PSRAM.html">23. PSRAM Contorller</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emac.html">24. Emac</a></li>
<li class="toctree-l1"><a class="reference internal" href="USB.html">25. USB</a></li>
<li class="toctree-l1"><a class="reference internal" href="ISO11898.html">26. ISO11898</a></li>
<li class="toctree-l1"><a class="reference internal" href="MJPEG.html">27. MJPEG</a></li>
<li class="toctree-l1"><a class="reference internal" href="JDEC.html">28. JDEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="VENC.html">29. VENC</a></li>
<li class="toctree-l1"><a class="reference internal" href="NPUtoolchain.html">30. NPU toolchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="NPU.html">31. NPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="IPC.html">32. IPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="LowPower.html">33. LowPower</a></li>
<li class="toctree-l1"><a class="reference internal" href="SEC_ENG.html">34. SEC ENG</a></li>
<li class="toctree-l1"><a class="reference internal" href="version.html">35. Revision history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BL808 Reference Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">17. </span>I2C</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="i2c">
<h1><span class="section-number">17. </span>I2C<a class="headerlink" href="#i2c" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2><span class="section-number">17.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Inter-Integrated Circuit (I2C) is a serial communication bus, which uses a multi-slave and multi-master architecture and is connected to low-speed peripherals.
Each device has a unique address identifier and can be used as a transmitter or receiver. The address of each device connected to the bus can be set by software through a unique address and the existing master or slave relation. The master can work as a master transmitter or a master receiver.
If two or more masters are initialized at the same time, data can be prevented from being damaged through conflict detection and arbitration during transmission.</p>
<p>BL808 has four I2C controller masters, whose slaveAddr, subAddr, and data to be transferred can be flexibly configured, to facilitate communication with slaves. With the FIFO of 2-word depth and interrupt function, it can be used with DMA to improve efficiency and supports flexible adjustment of clock frequency.</p>
</section>
<section id="features">
<h2><span class="section-number">17.2. </span>Features<a class="headerlink" href="#features" title="Permalink to this headline"></a></h2>
<ul class="simple">
<li><p>Master mode</p></li>
<li><p>Multi-master mode and arbitration function</p></li>
<li><p>Flexible adjustment of clock frequency</p></li>
<li><p>Supports 10-bit address mode</p></li>
<li><p>Supports DMA transfer mode</p></li>
</ul>
</section>
<section id="functional-description">
<h2><span class="section-number">17.3. </span>Functional Description<a class="headerlink" href="#functional-description" title="Permalink to this headline"></a></h2>
<table class="colwidths-given docutils align-center" id="id1" style="width: 80%">
<caption><span class="caption-number">Table 17.1 </span><span class="caption-text">I2C pin list</span><a class="headerlink" href="#id1" title="Permalink to this table"></a></caption>
<colgroup>
<col style="width: 30%" />
<col style="width: 30%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Type</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>I2Cx_SCL</p></td>
<td><p>Input/output</p></td>
<td><p>I2C serial clock signal</p></td>
</tr>
<tr class="row-odd"><td><p>I2Cx_SDA</p></td>
<td><p>Input/output</p></td>
<td><p>I2C serial data signal</p></td>
</tr>
</tbody>
</table>
<section id="start-and-stop-conditions">
<h3><span class="section-number">17.3.1. </span>Start and stop conditions<a class="headerlink" href="#start-and-stop-conditions" title="Permalink to this headline"></a></h3>
<p>All transmissions start with a START condition and end with a STOP condition.
The START and STOP conditions are generally generated by the master. The bus is considered to be busy after the START condition and to be idle for a certain period of time after the STOP condition.</p>
<p>START condition: SDA produces a high-to-low level transition when SCL is high;</p>
<p>STOP condition: SDA produces a low-to-high level transition when SCL is high.</p>
<p>Waveform diagram:</p>
<figure class="align-center" id="id2">
<img alt="../_images/I2CStopStart.svg" src="../_images/I2CStopStart.svg" /><figcaption>
<p><span class="caption-number">Fig. 17.1 </span><span class="caption-text">Start and stop conditions of I2C</span><a class="headerlink" href="#id2" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="data-transfer-format">
<h3><span class="section-number">17.3.2. </span>Data Transfer Format<a class="headerlink" href="#data-transfer-format" title="Permalink to this headline"></a></h3>
<p>7-bit address mode:</p>
<p>The first 8 bits transferred are addressing bytes, including a 7-bit slave address and a 1-bit direction bit. Sending or receiving data by the master is controlled by the 8th bit in the first byte sent by the master. If it is 0, it means that the data is sent by the master, while “1” indicates that data is received by the master, followed by the slave sending out an acknowledgement (ACK) bit. Upon data transfer completed, the master sends out a STOP signal, with waveform shown below:</p>
<figure class="align-center" id="id3">
<img alt="../_images/I2CMasterTxRx.svg" src="../_images/I2CMasterTxRx.svg" /><figcaption>
<p><span class="caption-number">Fig. 17.2 </span><span class="caption-text">I2C data transfer format</span><a class="headerlink" href="#id3" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p><strong>Master Transmit and Slave Receive Timing</strong></p>
<figure class="align-center" id="id4">
<img alt="../_images/I2CMasterTxSlaveRx.svg" src="../_images/I2CMasterTxSlaveRx.svg" /><figcaption>
<p><span class="caption-number">Fig. 17.3 </span><span class="caption-text">Timing of master transmitter and slave receiver</span><a class="headerlink" href="#id4" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p><strong>Master Receive and Slave Transmit Timing</strong></p>
<figure class="align-center" id="id5">
<img alt="../_images/I2CMasterRxSlaveTx.svg" src="../_images/I2CMasterRxSlaveTx.svg" /><figcaption>
<p><span class="caption-number">Fig. 17.4 </span><span class="caption-text">Timing of master receiver and slave transmitter</span><a class="headerlink" href="#id5" title="Permalink to this image"></a></p>
</figcaption>
</figure>
<p>10-bit address mode: The cr_i2c_10b_addr_en in the register i2c_config must be set to 1 before use.</p>
<p>The 10-bit slave address consists of the two bytes after the START condition (S) or the repeated START condition (Sr). The first 7 bits of the first byte are 1111 0XX, where XX are the first two bits of MSB of the 10-bit address. The 8th bit of the first byte is the read/write bit that determines the transfer direction.
Although there are 8 possible combinations of 1111 XXX, only the four types of 1111 0XX can be used for 10-bit addressing, and the remaining four types of 1111 1XX are used for future I2C expansion.</p>
<p>The aforementioned read-write formats for 7-bit addressing all suit 10-bit addressing, as follows:</p>
<ol class="arabic simple">
<li><p>A master-transmitter sends data to a slave-receiver with a 10-bit slave address</p></li>
</ol>
<figure class="align-center">
<img alt="../_images/I2CMasterToSlave10BitAddress.svg" src="../_images/I2CMasterToSlave10BitAddress.svg" /></figure>
<p>The figure shows that the transfer direction is unchanged. When receiving the 10-bit address following the START condition, the slave compares the first byte (1111 0XX) of the slave address with its own address, and checks whether the eighth bit (read/write bit) is 0. It is possible that multiple devices all match and generate an acknowledgement (A1). Next, all the slaves start to match their own addresses with the 8 bits of the second byte (XXXX XXXX). At this time, only one slave matches and generates an acknowledgement (A2). The slave that is addressed by the master will remain in the addressed state until it receives a STOP condition or a repeated START condition, followed by a different slave address.</p>
<ol class="arabic simple" start="2">
<li><p>A master-receiver receives data from a slave-transmitter (10-bit slave address)</p></li>
</ol>
<figure class="align-center">
<img alt="../_images/I2CSlaveToMaster10BitAddress.svg" src="../_images/I2CSlaveToMaster10BitAddress.svg" /></figure>
<p>The transfer direction will change after the second read/write bit. Before the second acknowledgement A2, the process is the same as that of the master-transmitter addressing the slave-receiver. After the repeated START condition (Sr), the matched slave will remain in the addressed state. This slave will check whether the first 7 bits of the first byte after Sr are correct, and then test whether the 8th bit is 1 (read). If this also matches, the slave considers that it is addressed as a transmitter and generates an acknowledgement (A3). The slave-transmitter will remain in the addressed state until it receives the STOP condition (P) or the repeated START condition (Sr) followed by a different slave address. Then, under Sr, all the slaves will compare their addresses with 11110XX and test the eighth bit (read/write bit). However, they will not be addressed, because for 10-bit devices, the read/write bit is 1, or for 7-bit devices, the slave addresses of 1111 0XX do not match.</p>
</section>
<section id="arbitration">
<h3><span class="section-number">17.3.3. </span>Arbitration<a class="headerlink" href="#arbitration" title="Permalink to this headline"></a></h3>
<p>When there are multiple masters on I2C bus, it may happen that multiple masters start data transfer at the same time. At this time, the arbitration mechanism will decide which master has the right to transfer data, while other masters have to give up the control of the bus and wait until the bus is idle before transferring data again.</p>
<p>During data transfer, all masters must check whether the SDA is consistent with the data they want to send when SCL stays high. When the SDA level is different from the expected one, it means that other masters are transferring data at the same time. The masters with different SDA levels will lose the arbitration and other masters will complete the data transfer.</p>
<p>The waveform of two masters transferring data and initiating the arbitration mechanism at the same time is as follows:</p>
<figure class="align-center" id="id6">
<img alt="../_images/I2CTxRxTogether.svg" src="../_images/I2CTxRxTogether.svg" /><figcaption>
<p><span class="caption-number">Fig. 17.5 </span><span class="caption-text">Waveform of simultaneous data transfer</span><a class="headerlink" href="#id6" title="Permalink to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="i2c-clock-setting">
<h2><span class="section-number">17.4. </span>I2C Clock Setting<a class="headerlink" href="#i2c-clock-setting" title="Permalink to this headline"></a></h2>
<p>I2C clock can be derived from bclk (bus clock) and xclk, and frequency division can be done on this basis.
The register i2c_prd_data can divide the clock of the data segment. The I2C module divides data transfer into 4 stages. Each stage is controlled by a single byte in the register, and the number of samples of each stage can be set. The 4 numbers jointly determine the division factor of i2c clock.</p>
<p>For example, bclk is 32M now, and the default value of the register i2c_prd_data is 0x0f0f0f0f without configuration, so I2C’s clock frequency is 32M/((15 + 1) * 4) = 500K.
Similarly, registers i2c_prd_start and i2c_prd_stop will divide the clock of the start and stop bits, respectively.</p>
</section>
<section id="i2c-configuration-flow">
<h2><span class="section-number">17.5. </span>I2C Configuration Flow<a class="headerlink" href="#i2c-configuration-flow" title="Permalink to this headline"></a></h2>
<section id="configuration-items">
<h3><span class="section-number">17.5.1. </span>Configuration Items<a class="headerlink" href="#configuration-items" title="Permalink to this headline"></a></h3>
<ul class="simple">
<li><p>Read/write flag bit</p></li>
<li><p>Slave address</p></li>
<li><p>Slave register address</p></li>
<li><p>Slave register address length</p></li>
<li><p>Data (TX: configure the sent data; RX: store the received data)</p></li>
<li><p>Data length</p></li>
<li><p>Enable signal</p></li>
</ul>
</section>
<section id="read-write-flag-bit">
<h3><span class="section-number">17.5.2. </span>Read/Write Flag Bit<a class="headerlink" href="#read-write-flag-bit" title="Permalink to this headline"></a></h3>
<p>I2C supports TX and RX working statuses. The cr_i2c_pkt_dir in the register i2c_config represents the TX/RX status, “0” for TX status and “1” for RX status.</p>
</section>
<section id="slave-address">
<h3><span class="section-number">17.5.3. </span>Slave Address<a class="headerlink" href="#slave-address" title="Permalink to this headline"></a></h3>
<p>Each slave connected to I2C will have a unique device address, which is usually 7 bits long. This address will be written into the cr_i2c_slv_addr in the register i2c_config. I2C will automatically shift to the left by 1 bit before sending the address, and the TX/RX direction bit will be added to the LSB.</p>
</section>
<section id="slave-register-address">
<h3><span class="section-number">17.5.4. </span>Slave Register Address<a class="headerlink" href="#slave-register-address" title="Permalink to this headline"></a></h3>
<p>The slave register address represents the register address where I2C needs to read and write a slave register. The slave register address is written to the register i2c_sub_addr, and the cr_i2c_sub_addr_en in the register i2c_config must be set to 1.
If cr_i2c_sub_addr_en in the register i2c_config is set to 0, the I2C master will skip the slave register address field when sending.</p>
</section>
<section id="slave-register-address-length">
<h3><span class="section-number">17.5.5. </span>Slave Register Address Length<a class="headerlink" href="#slave-register-address-length" title="Permalink to this headline"></a></h3>
<p>The slave register address length is subtracted by 1 and then written to cr_i2c_sub_addr_bc in the register i2c_config.</p>
</section>
<section id="data">
<h3><span class="section-number">17.5.6. </span>Data<a class="headerlink" href="#data" title="Permalink to this headline"></a></h3>
<p>It refers to the data that needs to be sent to or received from the slave.
When sending data, I2C must write the data (in word) into the register i2c_fifo_wdata.
When receiving data, I2C must read out the data (in word) from the register i2c_fifo_rdata.</p>
</section>
<section id="data-length">
<h3><span class="section-number">17.5.7. </span>Data Length<a class="headerlink" href="#data-length" title="Permalink to this headline"></a></h3>
<p>The data length is subtracted by 1 and then written to cr_i2c_pkt_len in the register i2c_config.</p>
</section>
<section id="enable-signal">
<h3><span class="section-number">17.5.8. </span>Enable Signal<a class="headerlink" href="#enable-signal" title="Permalink to this headline"></a></h3>
<p>After the above items are configured, when cr_i2c_m_en in the enable signal register i2c_config is set to 1, the I2C sending process will be started automatically.</p>
<p>When the read/write flag bit is configured as 0, I2C sends data and the master’s transmission flow is as follows:</p>
<ol class="arabic simple">
<li><p>Start bit</p></li>
<li><p>(The slave address shifts to the left by 1 bit + 0) + ACK</p></li>
<li><p>Slave register address + ACK</p></li>
<li><p>1-byte data + ACK</p></li>
<li><p>1-byte data + ACK</p></li>
<li><p>Stop bit</p></li>
</ol>
<p>When the read/write flag bit is configured as 1, I2C receives data and the master’s transmission flow is as follows:</p>
<ol class="arabic simple">
<li><p>Start bit</p></li>
<li><p>(The slave address shifts to the left by 1 bit + 0) + ACK</p></li>
<li><p>Slave register address + ACK</p></li>
<li><p>Start bit</p></li>
<li><p>(The slave address shifts to the left by 1 bit + 1) + ACK</p></li>
<li><p>1-byte data + ACK</p></li>
<li><p>1-byte data + ACK</p></li>
<li><p>Stop bit</p></li>
</ol>
</section>
</section>
<section id="fifo-management">
<h2><span class="section-number">17.6. </span>FIFO Management<a class="headerlink" href="#fifo-management" title="Permalink to this headline"></a></h2>
<p>I2C FIFO has a 2-word depth, and I2C includes RX FIFO and TX FIFO.
The rx_fifo_cnt in the register i2c_fifo_config_1 represents how much data (in word) in RX FIFO needs to be read.
The tx_fifo_cnt in the register i2c_fifo_config_1 represents how much free space (in word) in TX FIFO for writing.</p>
<p>I2C FIFO status:</p>
<ul class="simple">
<li><p>RX FIFO underflow: When the data in RX FIFO is completely read out or empty, if I2C continues to read data from RX FIFO, the rx_fifo_underflow in the register i2c_fifo_config_0 will be set to 1;</p></li>
<li><p>RX FIFO overflow: When I2C receives data until the two words of RX FIFO are filled, without reading RX FIFO, if I2C receives data again, the rx_fifo_overflow in the register i2c_fifo_config_0 will be set to 1;</p></li>
<li><p>TX FIFO underflow: When the data size filled into TX FIFO does not meet the configured I2C data length: cr_i2c_pkt_len in i2c_config, and no new data is filled into TX FIFO, the tx_fifo_underflow in the register i2c_fifo_config_0 will be set to 1;</p></li>
<li><p>TX FIFO overflow: After the two words of TX FIFO are filled, before the data in TX FIFO is sent out, if data is filled into TX FIFO again, the tx_fifo_overflow in the register i2c_fifo_config_0 will be set to 1.</p></li>
</ul>
</section>
<section id="use-with-dma">
<h2><span class="section-number">17.7. </span>Use with DMA<a class="headerlink" href="#use-with-dma" title="Permalink to this headline"></a></h2>
<p>I2C can send and receive data through DMA. Setting i2c_dma_tx_en in the register i2c_fifo_config_0 to 1 will enable the DMA TX mode. After the channel for I2C is allocated, DMA will transfer data from memory to the i2c_fifo_wdata register.
Setting i2c_dma_rx_en in the register i2c_fifo_config_0 to 1 will enable the DMA RX mode. After the channel for I2C is allocated, DMA will transfer the data in the register i2c_fifo_rdata to memory.
When I2C is used with DMA, DMA will automatically transfer data, so it is unnecessary for CPU to write data into I2C TX FIFO or read data from I2C RX FIFO.</p>
<section id="dma-sending-flow">
<h3><span class="section-number">17.7.1. </span>DMA Sending Flow<a class="headerlink" href="#dma-sending-flow" title="Permalink to this headline"></a></h3>
<ol class="arabic simple">
<li><p>Set read/write flag bit to 0</p></li>
<li><p>Set slave address</p></li>
<li><p>Set slave register address</p></li>
<li><p>Set slave register address length</p></li>
<li><p>Data Length</p></li>
<li><p>Set enable signal register to 1</p></li>
<li><p>Configure DMA transfer size</p></li>
<li><p>Configure the transfer width of DMA source address</p></li>
<li><p>Configure the transfer width of DMA destination address (when I2C is used with DMA, the transfer width of destination address must be set to 32 bits, which is word-aligned)</p></li>
<li><p>Configure the DMA source address as the memory address for storing sent data</p></li>
<li><p>Configure the DMA destination address to I2C TX FIFO address, i2c_fifo_wdata</p></li>
<li><p>Enable DMA</p></li>
</ol>
</section>
<section id="dma-receiving-flow">
<h3><span class="section-number">17.7.2. </span>DMA Receiving Flow<a class="headerlink" href="#dma-receiving-flow" title="Permalink to this headline"></a></h3>
<ol class="arabic simple">
<li><p>Set read/write flag bit to 1</p></li>
<li><p>Set slave address</p></li>
<li><p>Set slave register address</p></li>
<li><p>Set slave register address length</p></li>
<li><p>Data Length</p></li>
<li><p>Set enable signal register to 1</p></li>
<li><p>Configure DMA transfer size</p></li>
<li><p>Configure the transfer width of DMA source address (when I2C is used with DMA, the transfer width of source address must be set to 32 bits, which is word-aligned)</p></li>
<li><p>Configure the transfer width of DMA destination address</p></li>
<li><p>Configure the DMA source address to I2C RX FIFO address, i2c_fifo_rdata</p></li>
<li><p>Configure the DMA destination address as the memory address for storing received data</p></li>
<li><p>Enable DMA</p></li>
</ol>
</section>
</section>
<section id="interrupt">
<h2><span class="section-number">17.8. </span>Interrupt<a class="headerlink" href="#interrupt" title="Permalink to this headline"></a></h2>
<p>I2C includes the following interrupts:</p>
<ul class="simple">
<li><p>I2C_TRANS_END_INT: I2C end of transfer interrupt</p></li>
<li><p>I2C_TX_FIFO_READY_INT: The interrupt is triggered when I2C TX FIFO has free space for padding</p></li>
<li><p>I2C_RX_FIFO_READY_INT: The interrupt is triggered when I2C RX FIFO receives data</p></li>
<li><p>I2C_NACK_RECV_INT: The interrupt is triggered when I2C detects the NACK state</p></li>
<li><p>I2C_ARB_LOST_INT: I2C arbitration lost interrupt</p></li>
<li><p>I2C_FIFO_ERR_INT: I2C FIFO ERROR interrupt</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="UART.html" class="btn btn-neutral float-left" title="16. UART" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="PWM.html" class="btn btn-neutral float-right" title="18. PWM" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>