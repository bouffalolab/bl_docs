<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>27. MJPEG &mdash; BL808 Reference Manual  documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/style.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="28. JDEC" href="JDEC.html" />
    <link rel="prev" title="26. SDH" href="SDH.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> BL808 Reference Manual
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="SystemAndMemoryOverview.html">1. System and Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="ResetAndClock.html">2. Reset and Clock</a></li>
<li class="toctree-l1"><a class="reference internal" href="GLB.html">3. GLB</a></li>
<li class="toctree-l1"><a class="reference internal" href="GPIO.html">4. GPIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="ADC.html">5. ADC</a></li>
<li class="toctree-l1"><a class="reference internal" href="DAC.html">6. DAC</a></li>
<li class="toctree-l1"><a class="reference internal" href="DMA.html">7. DMA</a></li>
<li class="toctree-l1"><a class="reference internal" href="DMA2D.html">8. DMA2D</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lz4d.html">9. LZ4D</a></li>
<li class="toctree-l1"><a class="reference internal" href="DBI.html">10. DBI</a></li>
<li class="toctree-l1"><a class="reference internal" href="DPI.html">11. DPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="DSI.html">12. DSI</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cam.html">13. CAM</a></li>
<li class="toctree-l1"><a class="reference internal" href="IR.html">14. IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="SPI.html">15. SPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="UART.html">16. UART</a></li>
<li class="toctree-l1"><a class="reference internal" href="I2C.html">17. I2C</a></li>
<li class="toctree-l1"><a class="reference internal" href="PWM.html">18. PWM</a></li>
<li class="toctree-l1"><a class="reference internal" href="TIMER.html">19. TIMER</a></li>
<li class="toctree-l1"><a class="reference internal" href="I2s.html">20. I2S</a></li>
<li class="toctree-l1"><a class="reference internal" href="PDM.html">21. PDM</a></li>
<li class="toctree-l1"><a class="reference internal" href="AUDIO.html">22. AUDIO</a></li>
<li class="toctree-l1"><a class="reference internal" href="PSRAM.html">23. PSRAM Contorller</a></li>
<li class="toctree-l1"><a class="reference internal" href="Emac.html">24. Emac</a></li>
<li class="toctree-l1"><a class="reference internal" href="USB.html">25. USB</a></li>
<li class="toctree-l1"><a class="reference internal" href="SDH.html">26. SDH</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">27. MJPEG</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">27.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#features">27.2. Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#functional-description">27.3. Functional Description</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#input-configuration">27.3.1. Input Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#quantization-coefficient-table">27.3.2. Quantization Coefficient Table</a></li>
<li class="toctree-l3"><a class="reference internal" href="#software-mode-and-linked-mode">27.3.3. Software Mode and Linked Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#swap-mode">27.3.4. Swap Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kick-mode">27.3.5. Kick Mode</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jpg-function">27.3.6. Jpg Function</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cached-image-information">27.3.7. Cached Image Information</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-interrupts-separately-configured">27.3.8. Multiple Interrupts (Separately Configured)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="JDEC.html">28. JDEC</a></li>
<li class="toctree-l1"><a class="reference internal" href="VENC.html">29. VENC</a></li>
<li class="toctree-l1"><a class="reference internal" href="NPUtoolchain.html">30. NPU toolchain</a></li>
<li class="toctree-l1"><a class="reference internal" href="NPU.html">31. NPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="IPC.html">32. IPC</a></li>
<li class="toctree-l1"><a class="reference internal" href="LowPower.html">33. LowPower</a></li>
<li class="toctree-l1"><a class="reference internal" href="SEC_ENG.html">34. SEC ENG</a></li>
<li class="toctree-l1"><a class="reference internal" href="version.html">35. Revision history</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BL808 Reference Manual</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">27. </span>MJPEG</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mjpeg">
<h1><span class="section-number">27. </span>MJPEG<a class="headerlink" href="#mjpeg" title="Permalink to this headline"></a></h1>
<section id="overview">
<h2><span class="section-number">27.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this headline"></a></h2>
<p>Motion Joint Photographic Experts Group (MJPEG), a video encoding format, can be accurate to frame editing and multi-layer image processing. The motion video sequence is treated as continuous still images, and this compression format compresses each frame separately and completely. Compressing the original data in the YCbCr format can greatly save the memory space occupied by a frame of image.</p>
</section>
<section id="features">
<h2><span class="section-number">27.2. </span>Features<a class="headerlink" href="#features" title="Permalink to this headline"></a></h2>
<ul>
<li><p>Configurable input formats:</p>
<blockquote>
<div><ul class="simple">
<li><p>YCbCr 4:2:2 planar or packed format</p></li>
<li><p>YCbCr 4:2:0 planar format</p></li>
<li><p>YCbCr 4:0:0</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Configurable arrangement order of Y, Cb and Cr input data</p></li>
<li><p>Free configuration of quantization coefficient table</p></li>
<li><p>Supports software and linked modes</p></li>
<li><p>Supports swap mode</p></li>
<li><p>Supports kick mode</p></li>
<li><p>Reserves jpg header space and automatically adds jpg tail</p></li>
<li><p>Caches up to 4 images continuously</p></li>
<li><p>Multiple application interrupts are beneficial to flexible use and error prompt</p></li>
</ul>
</section>
<section id="functional-description">
<h2><span class="section-number">27.3. </span>Functional Description<a class="headerlink" href="#functional-description" title="Permalink to this headline"></a></h2>
<section id="input-configuration">
<h3><span class="section-number">27.3.1. </span>Input Configuration<a class="headerlink" href="#input-configuration" title="Permalink to this headline"></a></h3>
<p>You can select the YCbCr format of input data by setting the &lt;REG_YUV_MODE&gt; bit in the register MJPEG_CONTROL_1, including YCbCr 4:2:2 planar or packed format, YCbCr 4:2:0 planar format, and YCbCr 4:0:0 grayscale image. When the YCbCr 4:2:2 packed format is selected, the order of Y, Cb and Cr can be configured by the high 8 bits of the register MJPEG_HEADER_BYTE. When other formats are selected, the order of Cb and Cr can be set by the &lt;REG_ORDER_U_EVEN&gt; bit in the register MJPEG_CONTROL_1. The configuration is shown as follows.</p>
<figure class="align-center">
<img alt="../_images/MJPEGYUYVInterleaveOrderConfiguration.svg" src="../_images/MJPEGYUYVInterleaveOrderConfiguration.svg" /></figure>
</section>
<section id="quantization-coefficient-table">
<h3><span class="section-number">27.3.2. </span>Quantization Coefficient Table<a class="headerlink" href="#quantization-coefficient-table" title="Permalink to this headline"></a></h3>
<p>The quantization coefficient table can be freely configured by the user. &lt;reg_q_0_00&gt; to &lt;reg_q_0_3F&gt; represents the quantization table of grayscale Y component, while &lt;reg_q_1_00&gt; to &lt;reg_q_1_3F&gt; represents the quantization table of chrominance information Cb and Cr. In the quantization table, the first column is followed by the second column in descending order from the upper left corner. That is, reg_q_0_00 represents the quantized values of the first column on the first row of Y component, reg_q_0_01 represents that of the first column on the second row of the same, reg_q_0_07 represents that of the first column on the eighth row of the same, reg_q_0_08 represents that of the second column on the first row of the same, and so on.</p>
</section>
<section id="software-mode-and-linked-mode">
<h3><span class="section-number">27.3.3. </span>Software Mode and Linked Mode<a class="headerlink" href="#software-mode-and-linked-mode" title="Permalink to this headline"></a></h3>
<p>Setting the &lt;REG_MJPEG_SW_MODE&gt; bit in the register MJPEG_CONTROL_2 to 1 will enable the software mode. In this mode, MJPEG will read the specified frames of original image data from the memory for compression, but the image data must be prepared in advance.</p>
<p>When the &lt;REG_MJPEG_SW_MODE&gt; bit in the register MJPEG_CONTROL_2 is cleared to 0, the linked mode is enabled. In this mode, MJPEG will process the output of CAM as its input by taking 8*8 data blocks as a unit. After CAM writes 8 lines of data into the memory, MJPEG will start to work. The memory space processed by MJPEG will be released to CAM for reuse, so that CAM can link with MJPEG using the storage space that is less than the size of an image.</p>
</section>
<section id="swap-mode">
<h3><span class="section-number">27.3.4. </span>Swap Mode<a class="headerlink" href="#swap-mode" title="Permalink to this headline"></a></h3>
<p>In the swap mode, MJPEG’s storage space will be evenly divided into two blocks. When the space of one block is used up, an interrupt will be generated to inform the software to read out the data, and then MJPEG will write data into the other block. Two blocks are used alternatively, so that you can process data with the storage space that is less than the size of a frame of image.</p>
</section>
<section id="kick-mode">
<h3><span class="section-number">27.3.5. </span>Kick Mode<a class="headerlink" href="#kick-mode" title="Permalink to this headline"></a></h3>
<p>When the &lt;REG_SW_KICK_MODE&gt; bit in the register MJPEG_CONTROL_2 is set to 1, the kick mode is enabled. In this mode, every time one “1” is written to the &lt;REG_SW_KICK&gt; bit in the register MJPEG_CONTROL_2, one compression will be performed. The number of compressed rows is determined by the &lt;REG_SW_KICK_HBLK&gt; bit in the register MJPEG_YUV_MEM_SW. It should be noted that the kick mode can only be used in the software mode, but not in the linked mode.</p>
</section>
<section id="jpg-function">
<h3><span class="section-number">27.3.6. </span>Jpg Function<a class="headerlink" href="#jpg-function" title="Permalink to this headline"></a></h3>
<p>The jpg function will automatically leave some bytes of space at the beginning of each frame of data and fill in zeros. The size of this space is set by the low 12 bits of the register MJPEG_HEADER_BYTE. If automatic padding of jpg tail is enabled, two bytes of data will be added at the end of each frame of data, and the value of the two bytes is 0xFFD9.</p>
</section>
<section id="cached-image-information">
<h3><span class="section-number">27.3.7. </span>Cached Image Information<a class="headerlink" href="#cached-image-information" title="Permalink to this headline"></a></h3>
<p>The module contains four FIFOs to record the image address, image size, and quantization coefficient. Every time this module completely writes a frame into the memory, it will record the start address, image size, and quantization coefficient of this frame of image in FIFO. However, when the memory is insufficient or four FIFOs are full, the module will automatically discard the information of the incoming image. In the part where the image information has been taken out, the oldest image information will be removed by performing the pop operation through APB. Then, FIFO will automatically push data to ensure the timing of the image information in FIFO.</p>
</section>
<section id="multiple-interrupts-separately-configured">
<h3><span class="section-number">27.3.8. </span>Multiple Interrupts (Separately Configured)<a class="headerlink" href="#multiple-interrupts-separately-configured" title="Permalink to this headline"></a></h3>
<ol class="upperalpha simple">
<li><p>Normal interrupt: You can set to generate an interrupt after a fixed number of images are written</p></li>
<li><p>Camera interrupt: When CAM overflows as MJPEG’s processing speed cannot keep up with the speed of writing in CAM, an interrupt will be generated</p></li>
<li><p>Memory interrupt: When the memory is rewritten, an interrupt will be generated</p></li>
<li><p>Frame interrupt: When there are more than 4 unprocessed images, an interrupt will be generated</p></li>
<li><p>Swap interrupt: When a memory block is full in the swap mode, an interrupt will be generated</p></li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="SDH.html" class="btn btn-neutral float-left" title="26. SDH" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="JDEC.html" class="btn btn-neutral float-right" title="28. JDEC" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>