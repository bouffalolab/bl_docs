============
复位和时钟
============
简介
========
芯片内的时钟源：XTAL，PLL，RC。搭配分频等配置送至各模块。

复位管理
===========
.. table:: 软件复位功能表1 

    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | BL808      | RST_PIN /Watch Dog / PDS             | SW.Reset          | System Reset (swrst_cfg2[2])/  | PDS /CPU           | PDS         |
    +            +                                      +                   +                                +                    +             +
    |            | Software Power On                    | (swrst_cfg1)      | PDS                            |                    |             |
    +            +                                      +                   +                                +                    +             +
    |            |  (swrst_cfg2[0])                     |                   |                                |                    |             |
    +============+======================================+===================+================================+====================+=============+
    | CPU(M0)    | ✔                                    |                   |                                | ✔                  |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | CPU(LP)    | ✔                                    |                   |                                |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | bus        | ✔                                    |                   | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | glb        | ✔                                    | swrst_s1[0]       |                                |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | mix        | ✔                                    | swrst_s1[1]       |                                |                    | ✔           |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | gpip       | ✔                                    | swrst_s1[2]       | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | sec_eng    | ✔                                    | swrst_s1[4]       | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | TZ         | ✔                                    |                   | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | efuse      | ✔                                    |                   |                                |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | dma        | ✔                                    | swrst_s1[12]      | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | psram      | ✔                                    | swrst_s1_ext[2]   | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | usb        | ✔                                    | swrst_s1_ext[3]   | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | emac       | ✔                                    | swrst_s1_ext[3]   | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | audio      | ✔                                    | swrst_s1_ext[5]   | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | dma2       | ✔                                    | swrst_s1_ext[8]   | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | pds        |                                      | swrst_s1[14]      |                                |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | uart0      | ✔                                    | swrst_s1a[0]      | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | uart1      | ✔                                    | swrst_s1a[1]      | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | spi        | ✔                                    | swrst_s1a[2]      | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | i2c        | ✔                                    | swrst_s1a[3]      | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | pwm        | ✔                                    | swrst_s1a[4]      | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | timer      | ✔                                    | swrst_s1a[5]      | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | irr        | ✔                                    | swrst_s1a[6]      | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | uart2      | ✔                                    | swrst_s1a[10]     | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | i2s        | ✔                                    | swrst_s1a[11]     | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | pdm        | ✔                                    | swrst_s1a[12]     | ✔                              |                    |             |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | wifi       | ✔                                    | swrst_s2[0]       |                                |                    | ✔           |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+
    | ble        | ✔                                    | swrst_s3[0][2]    |                                |                    | ✔           |
    +------------+--------------------------------------+-------------------+--------------------------------+--------------------+-------------+

.. table:: 软件复位功能表2 

    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | BL808_MM   |  Watch Dog /                       | SW.Reset          | System Reset           | MMCPU0             |
    +            +                                    +                   +                        +                    +
    |            | Software Power On (swrst_cfg2[0])  | (swrst_cfg1)      | (swrst_cfg2[2])        |                    |
    +============+====================================+===================+========================+====================+
    | CPU(D0)    | ✔                                  |                   |                        | ✔                  |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | bus        | ✔                                  |                   | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | mm_misc    | ✔                                  | swrst_mm_misc     | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | mm_dma     | ✔                                  | swrst_dma         | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | mm_2ddma   | ✔                                  | swrst_dma2d       | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | mm_uart    | ✔                                  | swrst_uart0       | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | mm_i2c     | ✔                                  | swrst_i2c0        | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | mm_ipc     | ✔                                  | swrst_i2c1        | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | mm_timer   | ✔                                  | swrst_timer       | ✔                      |                    | 
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | uhs_ctrl   | ✔                                  | swrst_pUHS        | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | disp_tsrc  | ✔                                  | swrst_dp_tsrc     | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | nr3d_ctrl  | ✔                                  | swrst_nr3d_ctrl   | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | dvp2busA   | ✔                                  | swrst_dvp2busA    | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | dvp2busB   | ✔                                  | swrst_dvp2busB    | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | dvp2busC   | ✔                                  | swrst_dvp2busC    | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | dvp2busD   | ✔                                  | swrst_dvp2busD    | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | dvp2busE   | ✔                                  | swrst_dvp2busE    | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | dvp2busF   | ✔                                  | swrst_dvp2busF    | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | dvp2busG   | ✔                                  | swrst_dvp2busG    | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | dvp2busH   | ✔                                  | swrst_dvp2busH    | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | jdec       | ✔                                  | swrst_mjpeg_dec   | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+
    | blai       | ✔                                  | swrst_cnn         | ✔                      |                    |
    +------------+------------------------------------+-------------------+------------------------+--------------------+



时钟源
===========

时钟源包含：

- XTAL   ：外部晶振时钟，视系统需求频率可选 24、32、38.4、40MHz
- XTAL32K：外部晶振时钟，频率32kHz
- RC32K  ：RC振荡器时钟，频率32kHz，提供校准
- RC32M  ：RC振荡器时钟，频率32MHz，提供校准
- PLL    ：多个PLL模块，可以产生若干不同频率的时钟，以满足各个应用场景

时钟控制单元将来自振荡器的时钟分配给内核和外围设备。
可通过选择系统时钟源，动态分频器，时钟配置，睡眠使用32kHz时钟，以达到低功耗时钟管理。

外围设备时钟包括: Flash、UART、I2C、SPI、PWM、IR-remote、ADC、DAC。

.. figure:: ../../picture/SystemClock.svg
   :align: center

   系统时钟架构
   
.. figure:: ../../picture/MoudleClock.svg
   :align: center

   模块时钟架构
   
.. figure:: ../../picture/PeripheralClock.svg
   :align: center
   :scale: 95%

   外设时钟架构


