

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. UART/SDIO启动镜像格式 &mdash; BL602 UART/SDIO启动及Flash烧写  文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style.css" type="text/css" />
    <link rel="index" title="索引" href="../genindex.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="prev" title="BL602 UART/SDIO启动及Flash烧写" href="../index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> BL602 UART/SDIO启动及Flash烧写
          

          
            
            <img src="../_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">BL602 UART/SDIO启动及Flash烧写</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. UART/SDIO启动镜像格式</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">1.1. 启动引脚</a></li>
<li class="toctree-l2"><a class="reference internal" href="#uart">1.2. UART握手</a></li>
<li class="toctree-l2"><a class="reference internal" href="#sdio">1.3. SDIO握手</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">1.4. 生成下载镜像文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">1.5. UART/SDIO下载程序通信协议</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#get-boot-info">1.5.1. Get boot info</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-boot-header">1.5.2. Load boot header</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-public-key-optional">1.5.3. Load public key (Optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-signature-optional">1.5.4. Load signature (Optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-aes-iv-optional">1.5.5. Load AES IV (Optional)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-segment-header">1.5.6. Load Segment Header</a></li>
<li class="toctree-l3"><a class="reference internal" href="#load-segment-data">1.5.7. Load Segment Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#check-image">1.5.8. Check image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-image">1.5.9. Run image</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">1.5.10. 错误应答帧</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">1.5.11. 下载流程示意</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#eflash-loader">2. Eflash_loader</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id6">2.1. 下载并运行Eflash_loader</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">2.2. Eflash_loader通信协议</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#chip-erase">2.2.1. Chip Erase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flash-erase">2.2.2. Flash Erase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flash-program">2.2.3. Flash Program</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flash-program-check">2.2.4. Flash Program Check</a></li>
<li class="toctree-l3"><a class="reference internal" href="#flash-read">2.2.5. Flash Read</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sha256-read">2.2.6. SHA256 Read</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">2.2.7. 错误应答帧</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">BL602 UART/SDIO启动及Flash烧写</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>1. UART/SDIO启动镜像格式</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="uart-sdio">
<h1>1. UART/SDIO启动镜像格式<a class="headerlink" href="#uart-sdio" title="永久链接至标题">¶</a></h1>
<p>BL602系列芯片支持UART/SDIO启动。可以通过UART/SDIO接口将一段可执行程序下载到RAM中运行。下载程序的结构，需要满足BL602 Bootrom
定义的格式。对于没有启动安全设定的应用程序，即不启用加密和签名的应用程序，其下载镜像的格式如下图所示：</p>
<div class="figure align-center" id="id9">
<img alt="../_images/uart_sdio_Boot_image_nosecret.png" src="../_images/uart_sdio_Boot_image_nosecret.png" />
<p class="caption"><span class="caption-text">UART/SDIO启动镜像(不加密&amp;不签名)</span></p>
</div>
<p>下载镜像由三部分组成：</p>
<ul class="simple">
<li><dl class="first docutils">
<dt>BootInfo</dt>
<dd>主要包含BootInfo的Magic Code，Flash的配置信息(UART下载不需要Flash信息，只是和Flash启动的镜像兼容）,PLL 配置信息，
启动参数信息以及镜像配置信息等。</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>SegmentHeader</dt>
<dd>下载程序或者数据段的段头信息，主要用于指定接下来传输的数据段，要放在内存的哪个地址以及数据长度等信息。</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>SegmenData</dt>
<dd>下载程序或者数据段的主体。</dd>
</dl>
</li>
</ul>
<p>SegmentHeader和SegmenData可以有多个，具体的个数信息在BootInfo的镜像配置信息中设定。</p>
<p>对于启用加密和签名设定的下载镜像，其文件格式如下所示：</p>
<div class="figure align-center" id="id10">
<img alt="../_images/uart_sdio_Boot_image.png" src="../_images/uart_sdio_Boot_image.png" />
<p class="caption"><span class="caption-text">UART/SDIO启动镜像(加密&amp;签名)</span></p>
</div>
<p>与普通下载镜像相比，加密和签名的镜像，BootInfo中需要包含公钥，签名以及AES IV等信息。
对于启用加密但是不签名的下载镜像，文件格式如下所示：</p>
<div class="figure align-center" id="id11">
<img alt="../_images/uart_sdio_Boot_image_secret.png" src="../_images/uart_sdio_Boot_image_secret.png" />
<p class="caption"><span class="caption-text">UART/SDIO启动镜像(加密&amp;不签名)</span></p>
</div>
<p>对于启用签名但是不启用加密的下载镜像，文件格式如下所示：</p>
<div class="figure align-center" id="id12">
<img alt="../_images/uart_sdio_Boot_image_sign.png" src="../_images/uart_sdio_Boot_image_sign.png" />
<p class="caption"><span class="caption-text">UART/SDIO启动镜像(签名&amp;不加密)</span></p>
</div>
<div class="section" id="id1">
<h2>1.1. 启动引脚<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>BL602系列支持一路UART，一路SDIO启动。</p>
<table border="1" class="docutils" id="id13">
<caption><span class="caption-text">UART/SDIO启动引脚分配</span><a class="headerlink" href="#id13" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="21%" />
<col width="43%" />
<col width="36%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>GPIO引脚</td>
<td>Function</td>
<td>Comments</td>
</tr>
<tr class="row-even"><td>GPIO8</td>
<td>Boot Pin</td>
<td>&#160;</td>
</tr>
<tr class="row-odd"><td>GPIO7</td>
<td>BL602 UART RXD</td>
<td rowspan="2">UART Channel1</td>
</tr>
<tr class="row-even"><td>GPIO16</td>
<td>BL602 UART TXD</td>
</tr>
<tr class="row-odd"><td>GPIO0</td>
<td>SDIO_CLK</td>
<td rowspan="6">SDIO Channel</td>
</tr>
<tr class="row-even"><td>GPIO1</td>
<td>SDIO_CMD</td>
</tr>
<tr class="row-odd"><td>GPIO2</td>
<td>SDIO_DATA0</td>
</tr>
<tr class="row-even"><td>GPIO3</td>
<td>SDIO_DATA1</td>
</tr>
<tr class="row-odd"><td>GPIO4</td>
<td>SDIO_DATA2</td>
</tr>
<tr class="row-even"><td>GPIO5</td>
<td>SDIO_DATA3</td>
</tr>
</tbody>
</table>
<p>若想要从UART/SDIO启动，需要将GPIO8拉高，然后复位芯片，Bootrom会依次扫描UART和SDIO这两个接口，并在该接口等待握手信号，
握手超时（2ms）后会进行下一个接口的扫描，如果在某个接口上握手成功，则进入接收数据处理流程，在数据处理期间，
一旦发送错误或者超时（2s）,会进行下一个接口的扫描，如此依次循环进行，直到收到合法的启动镜像，完成启动任务。</p>
</div>
<div class="section" id="uart">
<h2>1.2. UART握手<a class="headerlink" href="#uart" title="永久链接至标题">¶</a></h2>
<p>UART通信的配置为1bit起始位，8bit数据位，1bit停止位，无奇偶校验位。</p>
<p>Bootrom从UART/SDIO启动后，会循环检测GPIO7引脚的电平变化，当主机发送0x55数据串被捕捉后，Bootrom开始计算当前串口波特率，
并根据检测结果设定UART寄存器的值，并以当前波特率回复“OK”。主机收到“OK”后可以进行正常的通信。UART通信超时时间是2s,
Bootrom在回复“OK”以后的2s内如果没有收到任何数据，或者在通信过程中，出现2s以内没有收到任何数据，则认为是通信超时，
超时以后重新进入握手流程。</p>
<p>主机发送握手数据时间建议是5ms，以便让Bootrom有充足的时间检测到握手信号，主机收到“OK”以后，建议延时20ms再通信，以防止后续的
通信数据与之前的握手数据混在一起。</p>
<p>由于从UART/SDIO启动时，Bootrom使用RC32M时钟，握手波特率建议不超过500K。握手过程如下：</p>
<div class="figure align-center">
<img alt="../_images/uarthands.png" src="../_images/uarthands.png" />
</div>
</div>
<div class="section" id="sdio">
<h2>1.3. SDIO握手<a class="headerlink" href="#sdio" title="永久链接至标题">¶</a></h2>
<p>Bootrom会等待SDIO Host写握手寄存器（SDU_BASE+0x160），当SDIO查询到握手寄存器被写1以后，
认为握手成功。Bootrom会等待主机发送数据，并根据接收到数据命令进行处理，如果发生超时(2s内没有接收到数据）会重新进入握手流程。</p>
</div>
<div class="section" id="id2">
<h2>1.4. 生成下载镜像文件<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>博流提供了UART/SDIO下载镜像生成工具，用户可通过下载<a class="reference external" href="https://dev.bouffalolab.com/download">Bouffalo Lab Dev Cube For Windows</a>，
获取最新的Dev Cube，运行 BLDevCube.exe, 在 Chip Type 中选择 BL602/604，进入烧写界面。在 View 菜单中选择 MCU 选项，进入MCU程序下载界面。</p>
<div class="figure align-center">
<img alt="../_images/create_image.png" src="../_images/create_image.png" />
</div>
<p>如若只生成UART/SDIO下载镜像，则可只配置右侧的烧录镜像参数，具体配置如下：</p>
<ul class="simple">
<li>Boot Source：选择UART/SDIO，表示生成UART/SDIO启动镜像</li>
<li>BootInfo Addr：程序启动参数的存放地址，此处填写 0x0即可</li>
<li>Image Type：默认为 SingleCPU</li>
<li>Image Addr：应用程序的下载地址，用户可根据实际程序的运行地址填写即可，例如0x22020800</li>
<li>Image File：选择用户编译生成中的RAM程序。</li>
</ul>
<p>完成选项配置后，点击 Create&amp;Download 按钮，会生成对应的镜像文件。生成的文件路径为: bl602/img_create2/img_if.bin。
img_if.bin就是满足UART/SDIO启动镜像格式的文件。</p>
<p>如需启用加密和签名功能，展开工具中的advanced options选项，完成配置后，同样点击Create&amp;Download 按钮即可。</p>
</div>
<div class="section" id="id3">
<h2>1.5. UART/SDIO下载程序通信协议<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>Bootrom在完成UART/SDIO通信握手后，即可进入正常的下载程序通信流程，下面详细介绍通信过程。
需要注意的是，Bootrom所能接收的协议数据最大长度为4096bytes。</p>
<div class="section" id="get-boot-info">
<h3>1.5.1. Get boot info<a class="headerlink" href="#get-boot-info" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id14">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id14" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="21%" />
<col width="25%" />
<col width="29%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>Rsvd(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
</tr>
<tr class="row-even"><td>0x10</td>
<td>0x00</td>
<td>0x00</td>
<td>0x00</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id15">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id15" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="17%" />
<col width="18%" />
<col width="17%" />
<col width="28%" />
<col width="20%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>BootRom Version(4bytes)</td>
<td>OTP info(16bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
<td>0x14</td>
<td>0x00</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>这是主机与BL602通信的第一条指令，读取BL602相关信息。主机要根据sign_type判断BL602是否要求接收签名的镜像；
根据encrypted判断BL602是否要求接收加密的镜像。如果已知芯片没有启动加密和签名，则可跳过对该信息的解析。</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="29%" />
<col width="36%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>&#160;</td>
<td>2b’00</td>
<td>其它</td>
</tr>
<tr class="row-even"><td>sign_type</td>
<td>不签名</td>
<td>签名</td>
</tr>
<tr class="row-odd"><td>encrypted</td>
<td>不加密</td>
<td>加密</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="load-boot-header">
<h3>1.5.2. Load boot header<a class="headerlink" href="#load-boot-header" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id16">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id16" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="19%" />
<col width="15%" />
<col width="19%" />
<col width="21%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>Rsvd(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>BootHeader(176bytes)</td>
</tr>
<tr class="row-even"><td>0x11</td>
<td>0x00</td>
<td>0xb0</td>
<td>0x00</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id17">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id17" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>176bytes的BootHeader结构体如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="n">__PACKED_STRUCT</span> <span class="n">boot_flash_cfg_t</span>
<span class="p">{</span>
     <span class="kt">uint32_t</span> <span class="n">magiccode</span><span class="p">;</span>       <span class="cm">/*&#39;FCFG&#39;*/</span>
     <span class="n">SPI_Flash_Cfg_Type</span> <span class="n">cfg</span><span class="p">;</span>
     <span class="kt">uint32_t</span> <span class="n">crc32</span><span class="p">;</span>
<span class="p">};</span>

 <span class="n">__PACKED_STRUCT</span> <span class="n">sys_clk_cfg_t</span>
<span class="p">{</span>
     <span class="kt">uint8_t</span> <span class="n">xtal_type</span><span class="p">;</span>
     <span class="kt">uint8_t</span> <span class="n">pll_clk</span><span class="p">;</span>
     <span class="kt">uint8_t</span> <span class="n">hclk_div</span><span class="p">;</span>
     <span class="kt">uint8_t</span> <span class="n">bclk_div</span><span class="p">;</span>

     <span class="kt">uint8_t</span> <span class="n">flash_clk_type</span><span class="p">;</span>
     <span class="kt">uint8_t</span> <span class="n">flash_clk_div</span><span class="p">;</span>
     <span class="kt">uint8_t</span> <span class="n">rsvd</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

 <span class="n">__PACKED_STRUCT</span> <span class="n">boot_clk_cfg_t</span>
<span class="p">{</span>
     <span class="kt">uint32_t</span> <span class="n">magiccode</span><span class="p">;</span>       <span class="cm">/*&#39;PCFG&#39;*/</span>

     <span class="k">struct</span> <span class="n">sys_clk_cfg_t</span> <span class="n">cfg</span><span class="p">;</span>

     <span class="kt">uint32_t</span> <span class="n">crc32</span><span class="p">;</span>
<span class="p">};</span>

 <span class="n">__PACKED_STRUCT</span> <span class="n">bootheader_t</span>
<span class="p">{</span>
     <span class="kt">uint32_t</span> <span class="n">magiccode</span><span class="p">;</span>                             <span class="cm">/*&#39;BFXP&#39;*/</span>
     <span class="kt">uint32_t</span> <span class="n">rivison</span><span class="p">;</span>
     <span class="k">struct</span> <span class="n">boot_flash_cfg_t</span> <span class="n">flashCfg</span><span class="p">;</span>
     <span class="k">struct</span> <span class="n">boot_clk_cfg_t</span>   <span class="n">clkCfg</span><span class="p">;</span>
     <span class="n">__PACKED_UNION</span> <span class="p">{</span>
         <span class="n">__PACKED_STRUCT</span> <span class="p">{</span>
             <span class="kt">uint32_t</span> <span class="nl">sign</span>               <span class="p">:</span>  <span class="mi">2</span><span class="p">;</span>   <span class="cm">/* [1: 0]  for sign*/</span>
             <span class="kt">uint32_t</span> <span class="nl">encrypt_type</span>       <span class="p">:</span>  <span class="mi">2</span><span class="p">;</span>   <span class="cm">/* [3: 2]  for encrypt */</span>
             <span class="kt">uint32_t</span> <span class="nl">key_sel</span>            <span class="p">:</span>  <span class="mi">2</span><span class="p">;</span>   <span class="cm">/* [5: 4]  for key sel in boot interface*/</span>
             <span class="kt">uint32_t</span> <span class="nl">rsvd6_7</span>            <span class="p">:</span>  <span class="mi">2</span><span class="p">;</span>   <span class="cm">/* [7: 6]  for encrypt*/</span>
             <span class="kt">uint32_t</span> <span class="nl">no_segment</span>         <span class="p">:</span>  <span class="mi">1</span><span class="p">;</span>   <span class="cm">/* [8]     no segment info */</span>
             <span class="kt">uint32_t</span> <span class="nl">cache_enable</span>       <span class="p">:</span>  <span class="mi">1</span><span class="p">;</span>   <span class="cm">/* [9]     for cache */</span>
             <span class="kt">uint32_t</span> <span class="nl">notload_in_bootrom</span> <span class="p">:</span>  <span class="mi">1</span><span class="p">;</span>   <span class="cm">/* [10]    not load this img in bootrom */</span>
             <span class="kt">uint32_t</span> <span class="nl">aes_region_lock</span>    <span class="p">:</span>  <span class="mi">1</span><span class="p">;</span>   <span class="cm">/* [11]    aes region lock */</span>
             <span class="kt">uint32_t</span> <span class="nl">cache_way_disable</span>  <span class="p">:</span>  <span class="mi">4</span><span class="p">;</span>   <span class="cm">/* [15: 12]  cache way disable info*/</span>
             <span class="kt">uint32_t</span> <span class="nl">crc_ignore</span>         <span class="p">:</span>  <span class="mi">1</span><span class="p">;</span>   <span class="cm">/* [16]    ignore crc */</span>
             <span class="kt">uint32_t</span> <span class="nl">hash_ignore</span>        <span class="p">:</span>  <span class="mi">1</span><span class="p">;</span>   <span class="cm">/* [17]    hash crc */</span>
             <span class="kt">uint32_t</span> <span class="nl">halt_ap</span>            <span class="p">:</span>  <span class="mi">1</span><span class="p">;</span>   <span class="cm">/* [18]    halt ap */</span>
             <span class="kt">uint32_t</span> <span class="nl">rsvd19_31</span>          <span class="p">:</span>  <span class="mi">13</span><span class="p">;</span>  <span class="cm">/* [31:19]  rsvd */</span>
         <span class="p">}</span> <span class="n">bval</span><span class="p">;</span>
         <span class="kt">uint32_t</span> <span class="n">wval</span><span class="p">;</span>
     <span class="p">}</span><span class="n">bootcfg</span> <span class="p">;</span>

     <span class="kt">uint32_t</span> <span class="n">segment_cnt</span><span class="p">;</span>

     <span class="kt">uint32_t</span> <span class="n">bootentry</span><span class="p">;</span>      <span class="cm">/* entry point of the image*/</span>

     <span class="kt">uint32_t</span> <span class="n">flashoffset</span><span class="p">;</span>

     <span class="kt">uint8_t</span> <span class="n">hash</span><span class="p">[</span><span class="n">BFLB_BOOTROM_HASH_SIZE</span><span class="p">];</span>    <span class="cm">/*hash of the image*/</span>

     <span class="kt">uint32_t</span> <span class="n">rsv1</span><span class="p">;</span>
     <span class="kt">uint32_t</span> <span class="n">rsv2</span><span class="p">;</span>
     <span class="kt">uint32_t</span> <span class="n">crc32</span><span class="p">;</span>
 <span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="load-public-key-optional">
<h3>1.5.3. Load public key (Optional)<a class="headerlink" href="#load-public-key-optional" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id18">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id18" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="19%" />
<col width="15%" />
<col width="19%" />
<col width="21%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>Rsvd(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>PKey(68bytes)</td>
</tr>
<tr class="row-even"><td>0x12</td>
<td>0x00</td>
<td>0x44</td>
<td>0x00</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id19">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id19" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>只有当镜像有签名的时候主机才发送这个命令。没有启动签名的情况下，应跳过这个命令的发送。68字节的Public Key结构体如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">__PACKED_STRUCT</span> <span class="n">pkey_cfg_t</span>
<span class="p">{</span>
    <span class="kt">uint8_t</span> <span class="n">eckeyx</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>        <span class="c1">//ec key in boot info</span>
    <span class="kt">uint8_t</span> <span class="n">eckeyy</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>        <span class="c1">//ec key in boot info</span>
    <span class="kt">uint32_t</span> <span class="n">crc32</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="load-signature-optional">
<h3>1.5.4. Load signature (Optional)<a class="headerlink" href="#load-signature-optional" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id20">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id20" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="19%" />
<col width="15%" />
<col width="19%" />
<col width="21%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>Rsvd(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>Signature(Nbytes)</td>
</tr>
<tr class="row-even"><td>0x14</td>
<td>0x00</td>
<td>N&amp;0xFF</td>
<td>(N&amp;0xFF00)&gt;&gt;8</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id21">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id21" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>只有当镜像有签名的时候主机才发送这个命令。没有启动签名的情况下，应跳过这个命令的发送。
Signature的有效长度不是固定的，其结构体示意如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">__PACKED_STRUCT</span> <span class="n">sign_cfg_t</span>
<span class="p">{</span>
        <span class="kt">uint32_t</span> <span class="n">sig_len</span><span class="p">;</span>
        <span class="kt">uint8_t</span> <span class="n">signature</span><span class="p">[</span><span class="n">sig_len</span><span class="p">];</span>
        <span class="kt">uint32_t</span> <span class="n">crc32</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>主机发送signature时可先读取sig_len获得需要发送的signature长度为sig_len+8。</p>
</div>
<div class="section" id="load-aes-iv-optional">
<h3>1.5.5. Load AES IV (Optional)<a class="headerlink" href="#load-aes-iv-optional" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id22">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id22" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="19%" />
<col width="15%" />
<col width="19%" />
<col width="21%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>Rsvd(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>AES IV(20bytes)</td>
</tr>
<tr class="row-even"><td>0x16</td>
<td>0x00</td>
<td>0x14</td>
<td>0x00</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id23">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id23" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>只有当镜像有加密的时候主机才发送这个命令。没有启动加密的情况下，应跳过这个命令的发送。</p>
<p>20bytes的AES IV结构体如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span> <span class="n">__PACKED_STRUCT</span> <span class="n">aesiv_cfg_t</span>
<span class="p">{</span>
      <span class="kt">uint8_t</span> <span class="n">aesiv</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
      <span class="kt">uint32_t</span> <span class="n">crc32</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="load-segment-header">
<h3>1.5.6. Load Segment Header<a class="headerlink" href="#load-segment-header" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id24">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id24" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="19%" />
<col width="15%" />
<col width="19%" />
<col width="21%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>Rsvd(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>Seg header(16bytes)</td>
</tr>
<tr class="row-even"><td>0x17</td>
<td>0x00</td>
<td>0x10</td>
<td>0x00</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id25">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id25" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>UART/SDIO启动镜像支持多个segment，每个segment的数据和代码可以由启动程序
加载到Segheader指定的地址上。而镜像中segment的个数由BootHeader中的
segment_cnt(具体参考2.2)成员决定。主机需要在Load boot header过程中记录下
这个变量，然后循环segment_cnt次Load Segment Header与Load Segment Data。</p>
<p>16bytes的seg header用下面的结构体描述：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">__PACKED_STRUCT</span> <span class="n">segment_header_t</span>
<span class="p">{</span>
         <span class="kt">uint32_t</span> <span class="n">destaddr</span><span class="p">;</span>
         <span class="kt">uint32_t</span> <span class="n">len</span><span class="p">;</span>
         <span class="kt">uint32_t</span> <span class="n">rsvd</span><span class="p">;</span>
         <span class="kt">uint32_t</span> <span class="n">crc32</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="load-segment-data">
<h3>1.5.7. Load Segment Data<a class="headerlink" href="#load-segment-data" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id26">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id26" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="19%" />
<col width="15%" />
<col width="19%" />
<col width="21%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>Rsvd(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>Seg Data(Nbytes)</td>
</tr>
<tr class="row-even"><td>0x18</td>
<td>0x00</td>
<td>N&amp;0xFF</td>
<td>(N&amp;0xFF00)&gt;&gt;8</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id27">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id27" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>对于一个Segment Data，由于一个协议帧4096bytes的限制，
可能需要多次发送Load Segment Data来传输数据。
这里要保证多次传递的数据帧中数据长度之和与Segment Header中描述的len相等。</p>
</div>
<div class="section" id="check-image">
<h3>1.5.8. Check image<a class="headerlink" href="#check-image" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id28">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id28" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="21%" />
<col width="25%" />
<col width="29%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>Rsvd(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
</tr>
<tr class="row-even"><td>0x19</td>
<td>0x00</td>
<td>0x00</td>
<td>0x00</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id29">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id29" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>镜像下载到RAM后，必须检查镜像的完整性与合法性。</p>
</div>
<div class="section" id="run-image">
<h3>1.5.9. Run image<a class="headerlink" href="#run-image" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id30">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id30" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="21%" />
<col width="25%" />
<col width="29%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>Rsvd(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
</tr>
<tr class="row-even"><td>0x1A</td>
<td>0x00</td>
<td>0x00</td>
<td>0x00</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id31">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id31" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>在Check image命令返回OK的情况下，通过该命令可以运行下载到RAM中的镜像，BL602执行该命令后就从UART/SDIO
启动程序跳转到下载的镜像程序中去运行。</p>
</div>
<div class="section" id="id4">
<h3>1.5.10. 错误应答帧<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h3>
<p>以上BL602Host的应答帧都是正确情况时的回复，如果在通信过程中出现错误，Bootrom错误返数据格式如下，用户可根据错误代码查询错误原因：</p>
<table border="1" class="docutils" id="id32">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id32" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="26%" />
<col width="39%" />
<col width="35%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘FL’(2bytes)</td>
<td>Error_Code_LSB(1byte)</td>
<td>Error_Code_MSB(1byte)</td>
</tr>
<tr class="row-even"><td>0x46 0x4C</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Error_Code列举如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/*error code definition*/</span>
<span class="k">typedef</span>  <span class="k">enum</span> <span class="n">tag_bootrom_error_code_t</span>
<span class="p">{</span>
     <span class="n">BFLB_BOOTROM_SUCCESS</span><span class="o">=</span><span class="mh">0x00</span><span class="p">,</span>

     <span class="cm">/*flash*/</span>
     <span class="n">BFLB_BOOTROM_FLASH_INIT_ERROR</span><span class="o">=</span><span class="mh">0x0001</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_FLASH_ERASE_PARA_ERROR</span><span class="o">=</span><span class="mh">0x0002</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_FLASH_ERASE_ERROR</span><span class="o">=</span><span class="mh">0x0003</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_FLASH_WRITE_PARA_ERROR</span><span class="o">=</span><span class="mh">0x0004</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_FLASH_WRITE_ADDR_ERROR</span><span class="o">=</span><span class="mh">0x0005</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_FLASH_WRITE_ERROR</span><span class="o">=</span><span class="mh">0x0006</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_FLASH_BOOT_PARA</span><span class="o">=</span><span class="mh">0x0007</span><span class="p">,</span>

     <span class="cm">/*cmd*/</span>
     <span class="n">BFLB_BOOTROM_CMD_ID_ERROR</span> <span class="o">=</span><span class="mh">0x0101</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_CMD_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0102</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_CMD_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0103</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_CMD_SEQ_ERROR</span><span class="o">=</span><span class="mh">0x0104</span><span class="p">,</span>

     <span class="cm">/*image*/</span>
     <span class="n">BFLB_BOOTROM_IMG_BOOTHEADER_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0201</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_BOOTHEADER_NOT_LOAD_ERROR</span><span class="o">=</span><span class="mh">0x0202</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_BOOTHEADER_MAGIC_ERROR</span><span class="o">=</span><span class="mh">0x0203</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_BOOTHEADER_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0204</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_BOOTHEADER_ENCRYPT_NOTFIT</span><span class="o">=</span><span class="mh">0x0205</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_BOOTHEADER_SIGN_NOTFIT</span><span class="o">=</span><span class="mh">0x0206</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SEGMENT_CNT_ERROR</span><span class="o">=</span><span class="mh">0x0207</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_AES_IV_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0208</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_AES_IV_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0209</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_PK_LEN_ERROR</span><span class="o">=</span><span class="mh">0x020a</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_PK_CRC_ERROR</span><span class="o">=</span><span class="mh">0x020b</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_PK_HASH_ERROR</span><span class="o">=</span><span class="mh">0x020c</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SIGNATURE_LEN_ERROR</span><span class="o">=</span><span class="mh">0x020d</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SIGNATURE_CRC_ERROR</span><span class="o">=</span><span class="mh">0x020e</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SECTIONHEADER_LEN_ERROR</span><span class="o">=</span><span class="mh">0x020f</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SECTIONHEADER_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0210</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SECTIONHEADER_DST_ERROR</span><span class="o">=</span><span class="mh">0x0211</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SECTIONDATA_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0212</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SECTIONDATA_DEC_ERROR</span><span class="o">=</span><span class="mh">0x0213</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SECTIONDATA_TLEN_ERROR</span><span class="o">=</span><span class="mh">0x0214</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SECTIONDATA_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0215</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_HALFBAKED_ERROR</span><span class="o">=</span><span class="mh">0x0216</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_HASH_ERROR</span><span class="o">=</span><span class="mh">0x0217</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SIGN_PARSE_ERROR</span><span class="o">=</span><span class="mh">0x0218</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_SIGN_ERROR</span><span class="o">=</span><span class="mh">0x0219</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_DEC_ERROR</span><span class="o">=</span><span class="mh">0x021a</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IMG_ALL_INVALID_ERROR</span><span class="o">=</span><span class="mh">0x021b</span><span class="p">,</span>

     <span class="cm">/*IF*/</span>
     <span class="n">BFLB_BOOTROM_IF_RATE_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0301</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IF_RATE_PARA_ERROR</span><span class="o">=</span><span class="mh">0x0302</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IF_PASSWORDERROR</span><span class="o">=</span><span class="mh">0x0303</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_IF_PASSWORDCLOSE</span><span class="o">=</span><span class="mh">0x0304</span><span class="p">,</span>

     <span class="cm">/*MISC*/</span>
     <span class="n">BFLB_BOOTROM_PLL_ERROR</span><span class="o">=</span><span class="mh">0xfffc</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_INVASION_ERROR</span><span class="o">=</span><span class="mh">0xfffd</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_POLLING</span><span class="o">=</span><span class="mh">0xfffe</span><span class="p">,</span>
     <span class="n">BFLB_BOOTROM_FAIL</span><span class="o">=</span><span class="mh">0xffff</span><span class="p">,</span>

 <span class="p">}</span><span class="n">bootrom_error_code_t</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="id5">
<h3>1.5.11. 下载流程示意<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h3>
<p>对于一个没有启用加密和签名的程序，在只有一个segment的时候，其下载流程示意如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span>1.设置BL602从UART/SDIO启动
2.打开串口，设置通信波特率，打开要下载的文件fp=open(&quot;img_if.bin&quot;,&quot;rb&quot;)
3.发送5ms的握手信号，UART_Send(0x555555...)
4.等待接收602的OK应答，延时20ms
5.发送get boot info命令
6.等待接收4+20字节的应答
7.读取176字节的数据，data=fp.read(176),使用load boot header 命令发送176字节的BootHeader
8.等待接收OK应答
9.读取16字节的数据，data=fp.read(16),解析SegmentData的总长度segDataLen，使用load segment header 命令发送16字节的SegmentHeader
10.等待接收OK应答
11.sendDataLen=0;
   while sendDataLen&lt;segDataLen:
        readDataLen=segDataLen-sendDataLen
        if readDataLen&gt;4096-4:
            readDataLen=4096-4:
        读取readDataLen字节数据，data=fp.read(readDataLen)
        使用load segment data 命令发送readDataLen字节的SegmentData
        sendDataLen+=readDataLen
        等待接收OK应答
12.发送Check image命令检查镜像，等待接收OK应答
13.发送Run image命令运行程序，等待接收OK应答
</pre></div>
</div>
<p>以上过程中，如Bootrom返回错误，则终止下载流程。</p>
</div>
</div>
</div>
<div class="section" id="eflash-loader">
<h1>2. Eflash_loader<a class="headerlink" href="#eflash-loader" title="永久链接至标题">¶</a></h1>
<p>Eflash_loader是由博流提供的用于Flash烧写、读取、校验的可执行程序，
可以通过UART/SDIO下载到RAM中运行。Eflash_Loader镜像没有加密与签名，
并且只有一个segment，其镜像结构如下图所示：</p>
<div class="figure align-center" id="id33">
<img alt="../_images/Eflash_Loader.png" src="../_images/Eflash_Loader.png" />
<p class="caption"><span class="caption-text">Eflash_Loader启动镜像</span></p>
</div>
<div class="section" id="id6">
<h2>2.1. 下载并运行Eflash_loader<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h2>
<p>通过上述1.5.11步骤，可以下载Elfash_loader到RAM并运行：
握手，Get boot info，Load boot header，Load Segment Header，Load Segment Data，Check image，Run Image。</p>
</div>
<div class="section" id="id7">
<h2>2.2. Eflash_loader通信协议<a class="headerlink" href="#id7" title="永久链接至标题">¶</a></h2>
<p>主机通过UART/SDIO把Eflash_loader下载到RAM中并运行后，主机继续通过UART接口与Eflash_loader通信。UART引脚同1.1，握手过程同1.2，
Eflash_loader中配置了高精度的PLL，可以使用较高的波特率进行握手通信，建议使用的波特率为115200、1M、2M、2.5M。握手成功后，
主机通过以下协议实现Flash烧录功能：</p>
<div class="section" id="chip-erase">
<h3>2.2.1. Chip Erase<a class="headerlink" href="#chip-erase" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id34">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id34" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="22%" />
<col width="25%" />
<col width="28%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>cksum(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
</tr>
<tr class="row-even"><td>0x3C</td>
<td>Cksum for len</td>
<td>0x00</td>
<td>0x00</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id35">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id35" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>该命令用于擦除整片Flash。这里参与校验和计算的数据为cksum字节后的所有数据(以下指令与此相同)。校验是可选项，如果不想开启校验，可以将cksum设置为0。</p>
<p>假设有data_len长度(包含Len_lsb和Len_msb)的数据要参与计算，计算校验和伪代码如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">uint32</span> <span class="n">sum</span><span class="p">;</span>
<span class="n">uint8</span> <span class="n">cksum</span>
<span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">data_len</span>
       <span class="n">sum</span><span class="o">+=</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="n">chsum</span><span class="o">=</span><span class="n">sum</span><span class="o">&amp;</span><span class="mh">0xff</span>
</pre></div>
</div>
</div>
<div class="section" id="flash-erase">
<h3>2.2.2. Flash Erase<a class="headerlink" href="#flash-erase" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id36">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id36" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="19%" />
<col width="15%" />
<col width="17%" />
<col width="18%" />
<col width="17%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>cksum(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>Start_addr(4bytes)</td>
<td>End_addr(4bytes)</td>
</tr>
<tr class="row-even"><td>0x30</td>
<td>Cksum datas behind</td>
<td>0x08</td>
<td>0x00</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id37">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id37" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>该命令用于擦除指定地址空间的Flash。</p>
<p>Flash的地址从0开始，这里以1M Flash为例示意Flash地址空间：</p>
<div class="figure align-center" id="id38">
<img alt="../_images/Flash_address.png" src="../_images/Flash_address.png" />
<p class="caption"><span class="caption-text">Flash地址空间示意</span></p>
</div>
</div>
<div class="section" id="flash-program">
<h3>2.2.3. Flash Program<a class="headerlink" href="#flash-program" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id39">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id39" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="19%" />
<col width="15%" />
<col width="17%" />
<col width="18%" />
<col width="17%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>cksum(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>Start_addr(4bytes)</td>
<td>payload(Nbytes)</td>
</tr>
<tr class="row-even"><td>0x31</td>
<td>Cksum datas behind</td>
<td>(N+4)&amp;0xff</td>
<td>((N+4)&gt;&gt;8)&amp;0xff</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id40">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id40" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>写入Nbytes数据到Flash指定地址空间。由于Eflash_loader中使用的缓冲区的限制，payload最大为8Kbytes。</p>
</div>
<div class="section" id="flash-program-check">
<h3>2.2.4. Flash Program Check<a class="headerlink" href="#flash-program-check" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id41">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id41" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="22%" />
<col width="25%" />
<col width="28%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>cksum(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
</tr>
<tr class="row-even"><td>0x3A</td>
<td>Cksum for len</td>
<td>0x00</td>
<td>0x00</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id42">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id42" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="100%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
</tr>
</tbody>
</table>
<p>该命令用于Flash烧写数据全部发送完毕后，用来确认Flash数据烧写过程中是否出现错误。如果Flash烧写全部正确，则返回OK。否则返回FL+错误代码，此处的错误代码是BFLB_EFLASH_LOADER_FLASH_WRITE_ERROR，详见错误应答帧。</p>
</div>
<div class="section" id="flash-read">
<h3>2.2.5. Flash Read<a class="headerlink" href="#flash-read" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id43">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id43" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="19%" />
<col width="15%" />
<col width="17%" />
<col width="18%" />
<col width="17%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>cksum(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>Start_addr(4bytes)</td>
<td>Read_len(4bytes)</td>
</tr>
<tr class="row-even"><td>0x32</td>
<td>Cksum datas behind</td>
<td>0x08</td>
<td>0x00</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id44">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id44" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>payload(Nbytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
<td>N&amp;0xff</td>
<td>(N&gt;&gt;8)&amp;0xff</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>该命令从Flash指定地址空间读取Nbytes数据。由于Eflash_loader中使用的缓冲区的限制，Read_len最大为8K。</p>
</div>
<div class="section" id="sha256-read">
<h3>2.2.6. SHA256 Read<a class="headerlink" href="#sha256-read" title="永久链接至标题">¶</a></h3>
<table border="1" class="docutils" id="id45">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id45" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="15%" />
<col width="19%" />
<col width="15%" />
<col width="17%" />
<col width="18%" />
<col width="17%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>cmdId(1byte)</td>
<td>cksum(1byte)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>Start_addr(4bytes)</td>
<td>Len(4bytes)</td>
</tr>
<tr class="row-even"><td>0x3D</td>
<td>Cksum datas behind</td>
<td>0x08</td>
<td>0x00</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<table border="1" class="docutils" id="id46">
<caption><span class="caption-text">BL602-&gt;Host</span><a class="headerlink" href="#id46" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="26%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘OK’(2bytes)</td>
<td>Len_lsb(1byte)</td>
<td>Len_msb(1byte)</td>
<td>payload(32bytes)</td>
</tr>
<tr class="row-even"><td>0x4F 0x4B</td>
<td>0x20</td>
<td>0x00</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>该命令用于快速校验Flash烧写是否正确。主机发送要计算的Flash数据的起始地址及长度，
BL602返回该段数据的SHA256值。主机也同步计算刚刚烧录文件的SHA256，然后与返回结果对比，可快速的校验Flash是否烧写正确。</p>
</div>
<div class="section" id="id8">
<h3>2.2.7. 错误应答帧<a class="headerlink" href="#id8" title="永久链接至标题">¶</a></h3>
<p>以上BL602Host的应答帧都是正确情况时的回复，Eflash_loader错误返回帧格式如下：</p>
<table border="1" class="docutils" id="id47">
<caption><span class="caption-text">Host-&gt;BL602</span><a class="headerlink" href="#id47" title="永久链接至表格">¶</a></caption>
<colgroup>
<col width="26%" />
<col width="39%" />
<col width="35%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>‘FL’(2bytes)</td>
<td>Error_Code_LSB(1byte)</td>
<td>Error_Code_MSB(1byte)</td>
</tr>
<tr class="row-even"><td>0x46 0x4C</td>
<td>&#160;</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
<p>Error_Code列举如下：</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="k">typedef</span>  <span class="k">enum</span> <span class="n">tag_eflash_loader_error_code_t</span>
<span class="p">{</span>
    <span class="n">BFLB_EFLASH_LOADER_SUCCESS</span><span class="o">=</span><span class="mh">0x00</span><span class="p">,</span>

    <span class="cm">/*flash*/</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_INIT_ERROR</span><span class="o">=</span><span class="mh">0x0001</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_ERASE_PARA_ERROR</span><span class="o">=</span><span class="mh">0x0002</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_ERASE_ERROR</span><span class="o">=</span><span class="mh">0x0003</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_WRITE_PARA_ERROR</span><span class="o">=</span><span class="mh">0x0004</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_WRITE_ADDR_ERROR</span><span class="o">=</span><span class="mh">0x0005</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_WRITE_ERROR</span><span class="o">=</span><span class="mh">0x0006</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_BOOT_PARA_ERROR</span><span class="o">=</span><span class="mh">0x0007</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_SET_PARA_ERROR</span><span class="o">=</span><span class="mh">0x0008</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_READ_STATUS_REG_ERROR</span><span class="o">=</span><span class="mh">0x0009</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FLASH_WRITE_STATUS_REG_ERROR</span><span class="o">=</span><span class="mh">0x000A</span><span class="p">,</span>

    <span class="cm">/*cmd*/</span>
    <span class="n">BFLB_EFLASH_LOADER_CMD_ID_ERROR</span> <span class="o">=</span><span class="mh">0x0101</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_CMD_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0102</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_CMD_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0103</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_CMD_SEQ_ERROR</span><span class="o">=</span><span class="mh">0x0104</span><span class="p">,</span>

    <span class="cm">/*image*/</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_BOOTHEADER_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0201</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_BOOTHEADER_NOT_LOAD_ERROR</span><span class="o">=</span><span class="mh">0x0202</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_BOOTHEADER_MAGIC_ERROR</span><span class="o">=</span><span class="mh">0x0203</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_BOOTHEADER_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0204</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_BOOTHEADER_ENCRYPT_NOTFIT</span><span class="o">=</span><span class="mh">0x0205</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_BOOTHEADER_SIGN_NOTFIT</span><span class="o">=</span><span class="mh">0x0206</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SEGMENT_CNT_ERROR</span><span class="o">=</span><span class="mh">0x0207</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_AES_IV_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0208</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_AES_IV_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0209</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_PK_LEN_ERROR</span><span class="o">=</span><span class="mh">0x020a</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_PK_CRC_ERROR</span><span class="o">=</span><span class="mh">0x020b</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_PK_HASH_ERROR</span><span class="o">=</span><span class="mh">0x020c</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SIGNATURE_LEN_ERROR</span><span class="o">=</span><span class="mh">0x020d</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SIGNATURE_CRC_ERROR</span><span class="o">=</span><span class="mh">0x020e</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SECTIONHEADER_LEN_ERROR</span><span class="o">=</span><span class="mh">0x020f</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SECTIONHEADER_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0210</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SECTIONHEADER_DST_ERROR</span><span class="o">=</span><span class="mh">0x0211</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SECTIONDATA_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0212</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SECTIONDATA_DEC_ERROR</span><span class="o">=</span><span class="mh">0x0213</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SECTIONDATA_TLEN_ERROR</span><span class="o">=</span><span class="mh">0x0214</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SECTIONDATA_CRC_ERROR</span><span class="o">=</span><span class="mh">0x0215</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_HALFBAKED_ERROR</span><span class="o">=</span><span class="mh">0x0216</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_HASH_ERROR</span><span class="o">=</span><span class="mh">0x0217</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SIGN_PARSE_ERROR</span><span class="o">=</span><span class="mh">0x0218</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_SIGN_ERROR</span><span class="o">=</span><span class="mh">0x0219</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_DEC_ERROR</span><span class="o">=</span><span class="mh">0x021a</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IMG_ALL_INVALID_ERROR</span><span class="o">=</span><span class="mh">0x021b</span><span class="p">,</span>

    <span class="cm">/*IF*/</span>
    <span class="n">BFLB_EFLASH_LOADER_IF_RATE_LEN_ERROR</span><span class="o">=</span><span class="mh">0x0301</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IF_RATE_PARA_ERROR</span><span class="o">=</span><span class="mh">0x0302</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IF_PASSWORDERROR</span><span class="o">=</span><span class="mh">0x0303</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_IF_PASSWORDCLOSE</span><span class="o">=</span><span class="mh">0x0304</span><span class="p">,</span>

    <span class="cm">/*MISC*/</span>
    <span class="n">BFLB_EFLASH_LOADER_PLL_ERROR</span><span class="o">=</span><span class="mh">0xfffc</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_INVASION_ERROR</span><span class="o">=</span><span class="mh">0xfffd</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_POLLING</span><span class="o">=</span><span class="mh">0xfffe</span><span class="p">,</span>
    <span class="n">BFLB_EFLASH_LOADER_FAIL</span><span class="o">=</span><span class="mh">0xffff</span><span class="p">,</span>

<span class="p">}</span><span class="n">eflash_loader_error_code_t</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="../index.html" class="btn btn-neutral float-left" title="BL602 UART/SDIO启动及Flash烧写" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>